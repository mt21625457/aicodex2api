# Sora å®¢æˆ·ç«¯åŠŸèƒ½å®Œå–„ â€” æŠ€æœ¯è®¾è®¡

## Context

### ç°çŠ¶

ç³»ç»Ÿå½“å‰çš„ Sora åŠŸèƒ½æ˜¯ä¸€ä¸ªä»¥é€ä¼ ä¸ºä¸»çš„ç½‘å…³ï¼ˆ`/sora/v1/chat/completions`ï¼‰ï¼Œé¢å‘ API å¼€å‘è€…ã€‚ç°çŠ¶ä»ä¼šå°è¯•å°†ç”Ÿæˆåª’ä½“è½åˆ°æœ¬åœ°ç£ç›˜ï¼ˆ`/app/data/sora`ï¼‰ï¼Œå¹¶ç”±æ¸…ç†ä»»åŠ¡åœ¨ 7 å¤©åæ¸…ç†ã€‚æ²¡æœ‰é¢å‘ç»ˆç«¯ç”¨æˆ·çš„ Web ç•Œé¢ï¼Œæ²¡æœ‰ S3 å¯¹è±¡å­˜å‚¨æ”¯æŒï¼Œæ²¡æœ‰ç”¨æˆ·é…é¢ç®¡ç†ï¼ŒSora å¹³å°è´¦å·ç±»å‹ä»…æ”¯æŒ OAuthã€‚

### ç›®æ ‡æ¶æ„

æ–°å¢ä¸€ä¸ªé¢å‘ç»ˆç«¯ç”¨æˆ·çš„ Sora å®¢æˆ·ç«¯å±‚ï¼Œä½äºç°æœ‰ç½‘å…³ä¹‹ä¸Šï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‰ç«¯ Sora å®¢æˆ·ç«¯ UI                      â”‚
â”‚              /sora (ç”Ÿæˆé¡µ + ä½œå“åº“)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ /api/v1/sora/*
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Sora Client Handler (æ–°å¢)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ é…é¢æ£€æŸ¥ â”‚ â”‚ ç”Ÿæˆè®°å½•  â”‚ â”‚ S3 ä¸Šä¼    â”‚ â”‚ å³æ—¶ä¸‹è½½   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ å†…éƒ¨è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç°æœ‰ Sora Gateway (ä¸å˜)                        â”‚
â”‚  /sora/v1/chat/completions                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ è´¦å·é€‰æ‹©  â”‚ â”‚ SDK ç›´è¿  â”‚ â”‚ HTTP é€ä¼ (apikey è´¦å·) â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çº¦æŸ

- ç°æœ‰ `/sora/v1/chat/completions` API å¿…é¡»å®Œå…¨å‘åå…¼å®¹
- S3 å­˜å‚¨åœ¨ç³»ç»Ÿè®¾ç½®ä¸­ç‹¬ç«‹é…ç½®ï¼ˆä½¿ç”¨ `aws-sdk-go-v2` ç›´è¿ï¼‰
- å‰ç«¯æŠ€æœ¯æ ˆï¼šVue 3 + TypeScript + TailwindCSSï¼ˆä¸ç°æœ‰å‰ç«¯ä¸€è‡´ï¼‰
- æš—è‰²ä¸»é¢˜é£æ ¼å‚è€ƒ sora.com å®˜æ–¹å®¢æˆ·ç«¯

## Goals / Non-Goals

### Goals

1. ç®¡ç†å‘˜åœ¨"ç³»ç»Ÿè®¾ç½®"ä¸­é…ç½® S3 å­˜å‚¨ï¼Œå‹¾é€‰å¼€æ”¾ç»™ Sora ç”¨æˆ·ä½¿ç”¨
2. æ¯ä¸ªç”¨æˆ·æœ‰å­˜å‚¨é…é¢é™åˆ¶ï¼Œé˜²æ­¢æ— é™ä½¿ç”¨
3. æä¾›å‚è€ƒ Sora å®˜æ–¹å®¢æˆ·ç«¯çš„ Web ç•Œé¢ï¼ˆç”Ÿæˆ + ä½œå“åº“ï¼‰
4. Sora å¹³å°æ”¯æŒ API Key è´¦å·ç±»å‹ï¼Œå®ç° sub2api çº§è”éƒ¨ç½²
5. API Key ç›´æ¥è°ƒç”¨ä¸å­˜å‚¨ï¼Œç›´æ¥è¿”å› URL
6. å®¢æˆ·ç«¯ UI è°ƒç”¨èµ°å­˜å‚¨ + è®°å½• + é…é¢ç®¡ç†

### Non-Goals

- ä¸å®ç° Sora å®˜æ–¹çš„ç¤¾äº¤åŠŸèƒ½ï¼ˆExplore ç¤¾åŒºã€å…³æ³¨ã€è¯„è®ºï¼‰
- ä¸å®ç°è§†é¢‘ç¼–è¾‘åŠŸèƒ½ï¼ˆRe-cutã€Remixã€Blendã€Loopï¼‰
- ä¸å®ç°è§’è‰²ï¼ˆCharactersï¼‰åŠŸèƒ½
- ä¸å®ç° Storyboard æ—¶é—´çº¿ç¼–è¾‘å™¨ï¼ˆä»…æ”¯æŒåˆ†é•œæç¤ºè¯æ ¼å¼ï¼‰
- ä¸å®ç°ç§»åŠ¨ç«¯ App
- ä¸æ”¯æŒç”¨æˆ·è‡ªè¡Œé…ç½®å­˜å‚¨ï¼ˆç”±ç®¡ç†å‘˜ç»Ÿä¸€é…ç½®ï¼‰

## Decisions

### D1: ä¸¤æ¡è°ƒç”¨è·¯å¾„åˆ†ç¦»ï¼ˆæ ¸å¿ƒå†³ç­–ï¼‰

**å†³ç­–**ï¼šAPI Key è°ƒç”¨ï¼ˆ`/sora/v1/chat/completions`ï¼‰å’Œå®¢æˆ·ç«¯ UI è°ƒç”¨ï¼ˆ`/api/v1/sora/generate`ï¼‰å®Œå…¨ç‹¬ç«‹ã€‚

**ç†ç”±**ï¼š

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| **A: ç»Ÿä¸€è·¯å¾„ï¼Œå…¨éƒ¨èµ°å­˜å‚¨** | å®ç°ç®€å• | API ç”¨æˆ·è¢«å¼ºåˆ¶æ¶ˆè€—å­˜å‚¨é…é¢ï¼›ç ´åç°æœ‰ API å…¼å®¹æ€§ |
| **B: ç»Ÿä¸€è·¯å¾„ï¼Œå‚æ•°æ§åˆ¶** | çµæ´» | API å¤æ‚åº¦å¢åŠ ï¼›éœ€è¦æ‰€æœ‰ API ç”¨æˆ·é€‚é…æ–°å‚æ•° |
| **âœ… C: ä¸¤æ¡ç‹¬ç«‹è·¯å¾„** | é›¶ç ´åæ€§å˜æ›´ï¼›èŒè´£æ¸…æ™° | ä¸¤å¥—ä»£ç è·¯å¾„éœ€ç»´æŠ¤ |

é€‰æ‹© Cã€‚`/sora/v1/chat/completions` ä¿æŒçº¯é€ä¼ ï¼Œ`/api/v1/sora/generate` åœ¨ä¸Šå±‚åŒ…è£…å­˜å‚¨/è®°å½•/é…é¢é€»è¾‘ã€‚

**å®ç°çº¦æŸ**ï¼š`SoraGatewayService.Forward()` ä»…è´Ÿè´£ç”Ÿæˆä¸ä¸Šæ¸¸äº¤äº’ï¼Œä¸åœ¨ API Key ç›´è°ƒè·¯å¾„æ‰§è¡Œåª’ä½“è½ç›˜ï¼›å®¢æˆ·ç«¯è·¯å¾„åœ¨ `SoraClientHandler` å†…è°ƒç”¨ç‹¬ç«‹å­˜å‚¨æœåŠ¡å®Œæˆ S3/æœ¬åœ°/ä¸Šæ¸¸é™çº§ã€‚

### D2: S3 å­˜å‚¨ä½¿ç”¨ aws-sdk-go-v2 ç›´è¿

**å†³ç­–**ï¼šç›´æ¥ä½¿ç”¨ `aws-sdk-go-v2` è¿æ¥ S3 å…¼å®¹å­˜å‚¨ï¼Œä¸ä¾èµ–ç°æœ‰æ•°æ®ç®¡ç†çš„ gRPC ä»£ç†ã€‚

**ç†ç”±**ï¼š
- ç°æœ‰ gRPC æ•°æ®ç®¡ç†ä»£ç†ä»…ç”¨äºå¤‡ä»½åŠŸèƒ½ï¼Œæ²¡æœ‰é€šç”¨æ–‡ä»¶ä¸Šä¼  RPC
- æ–°å¢ gRPC RPC ä¼šå¢åŠ å¯¹å¤–éƒ¨ä»£ç†è¿›ç¨‹çš„ä¾èµ–å’Œå¤æ‚åº¦
- `aws-sdk-go-v2` ç›´è¿æ›´çµæ´»ï¼Œæ”¯æŒæµå¼ä¸Šä¼ ã€é¢„ç­¾å URL ç­‰é«˜çº§åŠŸèƒ½
- S3 é…ç½®ç‹¬ç«‹å­˜å‚¨åœ¨ç³»ç»Ÿè®¾ç½®è¡¨ä¸­ï¼Œç®¡ç†å‘˜åœ¨ç³»ç»Ÿè®¾ç½®é¡µé¢é…ç½®

**S3 é…ç½®å­˜å‚¨**ï¼šåœ¨ Settings è¡¨ä¸­æ–°å¢ä»¥ä¸‹é”®å€¼ï¼š
- `sora_s3_enabled` â€” æ˜¯å¦å¯ç”¨ S3 å­˜å‚¨
- `sora_s3_endpoint` â€” S3 ç«¯ç‚¹ï¼ˆå¦‚ `https://s3.amazonaws.com`ï¼‰
- `sora_s3_region` â€” åŒºåŸŸ
- `sora_s3_bucket` â€” å­˜å‚¨æ¡¶
- `sora_s3_access_key_id` â€” è®¿é—®å¯†é’¥ ID
- `sora_s3_secret_access_key` â€” è®¿é—®å¯†é’¥ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
- `sora_s3_prefix` â€” å¯¹è±¡é”®å‰ç¼€ï¼ˆå¦‚ `sora/`ï¼‰
- `sora_s3_force_path_style` â€” æ˜¯å¦å¼ºåˆ¶è·¯å¾„æ¨¡å¼
- `sora_s3_cdn_url` â€” CDN åŸŸåï¼ˆå¯é€‰ï¼Œç”¨äºç”Ÿæˆå…¬å¼€ URLï¼‰

### D3: Sora API Key è´¦å·ç±»å‹å­˜å‚¨ä¸º `apikey`

**å†³ç­–**ï¼šSora å¹³å°çš„ API Key / ä¸Šæ¸¸é€ä¼ è´¦å·å­˜å‚¨ä¸º `type = "apikey"`ï¼ˆè€Œé `type = "upstream"`ï¼‰ã€‚

**ç†ç”±**ï¼š
- å¤ç”¨ Antigravity çš„ upstream æ¨¡å¼ï¼ˆUI ä¸Šæ˜¾ç¤ºä¸º"ä¸Šæ¸¸é€ä¼ "ï¼Œå­˜å‚¨ä¸º `apikey`ï¼‰
- `Account.GetBaseURL()` å·²æ”¯æŒ `apikey` ç±»å‹è¿”å› `base_url`
- åç«¯éªŒè¯å·²å…è®¸ `apikey` ç±»å‹
- æ— éœ€æ–°å¢æ•°æ®åº“å­—æ®µæˆ–å¸¸é‡

### D4: ç”Ÿæˆè®°å½•è¡¨è®¾è®¡

**å†³ç­–**ï¼šæ–°å»ºç‹¬ç«‹çš„ `sora_generations` è¡¨ï¼Œä¸æ‰©å±•ç°æœ‰ `usage_logs` è¡¨ã€‚

```sql
CREATE TABLE sora_generations (
    id              BIGSERIAL PRIMARY KEY,
    user_id         BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    api_key_id      BIGINT,

    -- ç”Ÿæˆå‚æ•°
    model           VARCHAR(64) NOT NULL,
    prompt          TEXT NOT NULL DEFAULT '',
    media_type      VARCHAR(16) NOT NULL DEFAULT 'video',  -- video/image

    -- ç»“æœ
    status          VARCHAR(16) NOT NULL DEFAULT 'pending', -- pending/generating/completed/failed/cancelled
    media_url       TEXT NOT NULL DEFAULT '',
    media_urls      JSONB,                                  -- å¤šå›¾æ—¶çš„ URL æ•°ç»„
    file_size_bytes BIGINT NOT NULL DEFAULT 0,
    storage_type    VARCHAR(16) NOT NULL DEFAULT 'none',    -- s3/local/upstream/none
    s3_object_keys  JSONB,                                   -- S3 object key æ•°ç»„ï¼ˆè§†é¢‘å•å…ƒç´ ï¼Œå¤šå›¾å¤šä¸ªï¼‰ï¼Œåˆ é™¤æ—¶é€ä¸€æ¸…ç†

    -- ä¸Šæ¸¸ä¿¡æ¯
    upstream_task_id VARCHAR(128) NOT NULL DEFAULT '',
    error_message    TEXT NOT NULL DEFAULT '',

    -- æ—¶é—´
    created_at      TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    completed_at    TIMESTAMPTZ,

    -- ç´¢å¼•åˆ—
    -- created_at ä¸åšå”¯ä¸€çº¦æŸï¼Œé¿å…åŒä¸€ç”¨æˆ·é«˜å¹¶å‘å†™å…¥æ—¶äº§ç”Ÿç¢°æ’
);

CREATE INDEX idx_sora_gen_user_created ON sora_generations(user_id, created_at DESC);
CREATE INDEX idx_sora_gen_user_status ON sora_generations(user_id, status);
```

**ç†ç”±**ï¼š
- `usage_logs` æ˜¯è®¡è´¹æ—¥å¿—ï¼Œæ··å…¥åª’ä½“ç®¡ç†ä¼šå¢åŠ å¤æ‚åº¦
- ç‹¬ç«‹è¡¨æ–¹ä¾¿æŸ¥è¯¢ï¼ˆæŒ‰ç”¨æˆ·ã€æŒ‰çŠ¶æ€ã€æŒ‰æ—¶é—´ï¼‰å’Œç®¡ç†ï¼ˆåˆ é™¤è”åŠ¨ S3 æ¸…ç†ï¼‰
- `s3_object_keys` ä¸º JSONB æ•°ç»„ï¼Œæ”¯æŒå•è§†é¢‘ï¼ˆ`["key.mp4"]`ï¼‰å’Œå¤šå›¾ï¼ˆ`["key1.jpg","key2.jpg"]`ï¼‰åœºæ™¯

### D5: é…é¢è¿½è¸ªæ–¹æ¡ˆ

**å†³ç­–**ï¼šåœ¨ `users` è¡¨æ–°å¢å­—æ®µï¼ˆè€Œéç‹¬ç«‹è¡¨ï¼‰ã€‚

```sql
ALTER TABLE users ADD COLUMN sora_storage_quota_bytes  BIGINT NOT NULL DEFAULT 0;  -- 0 = ä½¿ç”¨ç³»ç»Ÿé»˜è®¤
ALTER TABLE users ADD COLUMN sora_storage_used_bytes   BIGINT NOT NULL DEFAULT 0;
```

ç³»ç»Ÿé»˜è®¤é…é¢é€šè¿‡ Settings è¡¨å­˜å‚¨ï¼ˆ`sora_default_storage_quota_bytes`ï¼‰ã€‚

**ç†ç”±**ï¼š
- é…é¢æ˜¯ç”¨æˆ·çš„æ ¸å¿ƒå±æ€§ï¼Œæ”¾åœ¨ users è¡¨æŸ¥è¯¢æœ€é«˜æ•ˆ
- ä¸éœ€è¦ JOINï¼Œå‡å°‘è¯·æ±‚å»¶è¿Ÿ
- åˆ†ç»„çº§åˆ«çš„é…é¢è¦†ç›–é€šè¿‡ `groups.sora_storage_quota_bytes` å­—æ®µå®ç°

**é…é¢åˆ¤æ–­é€»è¾‘**ï¼š
```text
æœ‰æ•ˆé…é¢ = user.sora_storage_quota_bytes > 0
           ? user.sora_storage_quota_bytes
           : group.sora_storage_quota_bytes > 0
             ? group.sora_storage_quota_bytes
             : settings.sora_default_storage_quota_bytes
```

### D6: Sora apikey è´¦å·çš„ HTTP é€ä¼ å®ç°

**å†³ç­–**ï¼šåœ¨ `SoraGatewayService.Forward()` å¼€å¤´åŠ åˆ†æ”¯åˆ¤æ–­ï¼Œapikey ç±»å‹èµ°ç‹¬ç«‹çš„ HTTP é€ä¼ æ–¹æ³•ã€‚

```text
Forward(ctx, c, account, body, clientStream):
    if account.Type == "apikey" && account.GetBaseURL() != "":
        return s.forwardToUpstream(ctx, c, account, body, clientStream)
    // ... ç°æœ‰ SDK ç›´è¿é€»è¾‘
```

`forwardToUpstream()` çš„è¡Œä¸ºï¼š
- åˆ›å»º/æ›´æ–°è´¦å·æ—¶æ ¡éªŒ `base_url`ï¼šå¿…å¡«ï¼Œä¸”å¿…é¡»åŒ…å« `http://` æˆ– `https://` scheme
- æ„é€  HTTP è¯·æ±‚åˆ°è§„èŒƒåŒ–è·¯å¾„ `{base_url}/sora/v1/chat/completions`ï¼ˆå»é™¤é‡å¤æ–œæ ï¼‰
- Header: `Authorization: Bearer <api_key>`, `Content-Type: application/json`
- æµå¼å“åº”ï¼šé€å­—èŠ‚é€ä¼  SSE æµ
- éæµå¼å“åº”ï¼šè¯»å–å®Œæ•´å“åº”åè¿”å›
- é”™è¯¯å¤„ç†ï¼šå¤ç”¨ç°æœ‰çš„å¤±è´¥è½¬ç§»é€»è¾‘ï¼ˆ`UpstreamFailoverError`ï¼‰

### D7: å‰ç«¯ UI æ¶æ„ï¼ˆå‚è€ƒ Sora å®˜æ–¹å®¢æˆ·ç«¯ï¼‰

**å†³ç­–**ï¼šé‡‡ç”¨å•é¡µé¢ + Tab åˆ‡æ¢çš„è®¾è®¡ï¼Œä¸¤ä¸ªä¸»è§†å›¾ï¼š

**å‚è€ƒ sora.com çš„è®¾è®¡ç‰¹ç‚¹**ï¼š
- æš—è‰²ä¸»é¢˜ï¼ˆ#0D0D0D èƒŒæ™¯ï¼Œç™½è‰²æ–‡å­—ï¼‰
- åº•éƒ¨åˆ›ä½œæ ï¼ˆæç¤ºè¯è¾“å…¥åœ¨é¡µé¢åº•éƒ¨ï¼‰
- ç½‘æ ¼ä½œå“åº“ï¼ˆå¡ç‰‡ç¼©ç•¥å›¾ + hover é¢„è§ˆï¼‰
- å³ä¸Šè§’ç”Ÿæˆé˜Ÿåˆ—çŠ¶æ€æŒ‡ç¤º

**æˆ‘ä»¬çš„é€‚é…**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ç”Ÿæˆ]  [ä½œå“åº“]                         2.1GB/5GB   â”‚  â† é¡µé¢å†…å¯¼èˆªï¼ˆæ— Logo/å¤´åƒï¼Œç”±ä¾§è¾¹æ æä¾›ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  â³ ç”Ÿæˆä¸­  sora-2  "ä¸€åªçŒ«åœ¨æœˆçƒä¸Š..."        â”‚    â”‚  â† ä»»åŠ¡å¡ç‰‡ 1ï¼ˆæœ€æ–°ï¼‰
â”‚   â”‚   å·²ç­‰å¾… 3:42 Â· é¢„è®¡å‰©ä½™ 8 åˆ†é’Ÿ                â”‚    â”‚
â”‚   â”‚   [å–æ¶ˆç”Ÿæˆ]                                   â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  âœ… å·²å®Œæˆ  gpt-image-1                       â”‚    â”‚  â† ä»»åŠ¡å¡ç‰‡ 2ï¼ˆè‡ªåŠ¨ä¿å­˜æˆåŠŸï¼‰
â”‚   â”‚  âœ“ å·²ä¿å­˜åˆ°äº‘ç«¯  [ğŸ“¥ æœ¬åœ°ä¸‹è½½]                 â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  âœ… å·²å®Œæˆ  sora-2ï¼ˆæ— å­˜å‚¨é™çº§ï¼‰               â”‚    â”‚  â† ä»»åŠ¡å¡ç‰‡ 3ï¼ˆS3ä¸å¯ç”¨ï¼‰
â”‚   â”‚  [ğŸ“¥ æœ¬åœ°ä¸‹è½½]  â± å‰©ä½™ 11:28 å¯ä¸‹è½½            â”‚    â”‚  â† è¿‡æœŸå€’è®¡æ—¶
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                        â”‚
â”‚   æ— ä»»åŠ¡æ—¶: æ¬¢è¿ä½¿ç”¨ Sora Â· è¾“å…¥æç¤ºè¯å¼€å§‹åˆ›ä½œ          â”‚
â”‚                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¨¡å‹: [sora2-landscape-10s â–¼]    æ­£åœ¨ç”Ÿæˆ 1/3         â”‚  â† åº•éƒ¨åˆ›ä½œæ 
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æè¿°ä½ æƒ³è¦çš„è§†é¢‘æˆ–å›¾ç‰‡...                         â”‚ â”‚  â† æç¤ºè¯è¾“å…¥æ¡†
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  [æ¨ªå±] [ç«–å±] [æ–¹å½¢]  [10s] [15s] [25s]  [ğŸ“] [ç”Ÿæˆâ–¶] â”‚  â† è®¾ç½®æ 
â”‚  âš  å­˜å‚¨æœªé…ç½®ï¼Œç”Ÿæˆåè¯·ç«‹å³ä¸‹è½½                        â”‚  â† æ— å­˜å‚¨æç¤º(æ¡ä»¶æ˜¾ç¤º)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ŒæˆåæŒ‰é’®çŠ¶æ€è¯´æ˜**ï¼š
- S3 è‡ªåŠ¨ä¿å­˜æˆåŠŸï¼š`âœ“ å·²ä¿å­˜åˆ°äº‘ç«¯` + `ğŸ“¥ æœ¬åœ°ä¸‹è½½`ï¼ˆä½œå“è‡ªåŠ¨è¿›å…¥ä½œå“åº“ï¼‰
- é™çº§æœ¬åœ°å­˜å‚¨ï¼š`âœ“ å·²ä¿å­˜åˆ°æœ¬åœ°` + `ğŸ“¥ æœ¬åœ°ä¸‹è½½`
- S3 ä¸å¯ç”¨ï¼ˆupstreamï¼‰ï¼š`ğŸ“¥ æœ¬åœ°ä¸‹è½½` + 15 åˆ†é’Ÿè¿‡æœŸå€’è®¡æ—¶
- S3 åç»­å¯ç”¨æ—¶ï¼Œå†å² upstream è®°å½•å¯æ‰‹åŠ¨ `â˜ï¸ ä¿å­˜åˆ°å­˜å‚¨`

**ä½œå“åº“é¡µ**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ç”Ÿæˆ]  [ä½œå“åº“]                         2.1GB/5GB   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å…¨éƒ¨] [è§†é¢‘] [å›¾ç‰‡]                    æœç´¢...        â”‚  â† ç­›é€‰æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ ğŸ¬      â”‚ â”‚ ğŸ–¼ï¸      â”‚ â”‚ ğŸ¬      â”‚ â”‚ ğŸ¬      â”‚     â”‚
â”‚  â”‚         â”‚ â”‚         â”‚ â”‚         â”‚ â”‚         â”‚     â”‚  â† 4åˆ—ç½‘æ ¼
â”‚  â”‚ sora2.. â”‚ â”‚ gpt-img â”‚ â”‚ sora2.. â”‚ â”‚ sora2.. â”‚     â”‚
â”‚  â”‚ 3åˆ†é’Ÿå‰  â”‚ â”‚ 1å°æ—¶å‰  â”‚ â”‚ æ˜¨å¤©    â”‚ â”‚ 2å¤©å‰   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ ğŸ–¼ï¸      â”‚ â”‚ ğŸ¬      â”‚                              â”‚
â”‚  â”‚         â”‚ â”‚         â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç»„ä»¶æ‹†åˆ†**ï¼š

```text
views/user/SoraView.vue              ä¸»é¡µé¢å®¹å™¨
components/sora/
â”œâ”€â”€ SoraNavBar.vue                   é¡µé¢å†…å¯¼èˆªï¼ˆtabåˆ‡æ¢ + é…é¢ï¼Œæ— Logo/å¤´åƒï¼‰
â”œâ”€â”€ SoraGeneratePage.vue             ç”Ÿæˆé¡µ
â”‚   â”œâ”€â”€ SoraPromptBar.vue            åº•éƒ¨åˆ›ä½œæ 
â”‚   â”œâ”€â”€ SoraModelSelector.vue        æ¨¡å‹é€‰æ‹©ä¸‹æ‹‰
â”‚   â”œâ”€â”€ SoraProgressCard.vue         ç”Ÿæˆè¿›åº¦å¡ç‰‡
â”‚   â””â”€â”€ SoraNoStorageWarning.vue     æ— å­˜å‚¨æç¤º
â”œâ”€â”€ SoraLibraryPage.vue              ä½œå“åº“é¡µ
â”‚   â”œâ”€â”€ SoraLibraryGrid.vue          ç½‘æ ¼å¸ƒå±€
â”‚   â”œâ”€â”€ SoraMediaCard.vue            å•ä¸ªä½œå“å¡ç‰‡
â”‚   â””â”€â”€ SoraEmptyState.vue           ç©ºçŠ¶æ€
â”œâ”€â”€ SoraMediaPreview.vue             ä½œå“è¯¦æƒ…/é¢„è§ˆå¼¹çª—
â”œâ”€â”€ SoraQuotaBar.vue                 é…é¢å±•ç¤ºæ¡
â””â”€â”€ SoraDownloadDialog.vue           å³æ—¶ä¸‹è½½å¼¹çª—
```

### D8: Sora S3 é…ç½®ç‹¬ç«‹äºæ•°æ®ç®¡ç†

**å†³ç­–**ï¼šåœ¨ç³»ç»Ÿè®¾ç½®ï¼ˆSettings è¡¨ï¼‰ä¸­ç‹¬ç«‹å­˜å‚¨ Sora S3 é…ç½®ï¼Œä¸ä¿®æ”¹ç°æœ‰æ•°æ®ç®¡ç†çš„ gRPC Proto æˆ– S3 Profileã€‚

**ç†ç”±**ï¼š
- ç°æœ‰æ•°æ®ç®¡ç†ä½¿ç”¨ gRPC ä»£ç†æ¶æ„ï¼Œä¿®æ”¹ Proto éœ€è¦åŒæ­¥æ›´æ–°å¤–éƒ¨ Agent è¿›ç¨‹
- Sora S3 å­˜å‚¨ä¸å¤‡ä»½ S3 å­˜å‚¨çš„ç”¨é€”ä¸åŒï¼Œç‹¬ç«‹é…ç½®æ›´æ¸…æ™°
- ç³»ç»Ÿè®¾ç½®è¡¨å·²æœ‰æˆç†Ÿçš„è¯»å†™æœºåˆ¶ï¼Œæ–°å¢é…ç½®é¡¹æˆæœ¬æœ€ä½

**å‰ç«¯**ï¼šåœ¨ç³»ç»Ÿè®¾ç½®é¡µé¢ï¼ˆSettingsView.vueï¼‰æ–°å¢"Sora S3 å­˜å‚¨é…ç½®"åŒºåŸŸï¼ŒåŒ…å«ï¼š
- å¯ç”¨å¼€å…³
- S3 è¿æ¥ä¿¡æ¯è¡¨å•ï¼ˆendpointã€regionã€bucketã€access_key_idã€secret_access_keyï¼‰
- é«˜çº§é€‰é¡¹ï¼ˆprefixã€force_path_styleã€CDN URLï¼‰
- "æµ‹è¯•è¿æ¥"æŒ‰é’®

**è¿è¡Œæ—¶è·å–**ï¼šSora S3 Storage Service å¯åŠ¨æ—¶ä» Settings è¡¨è¯»å–é…ç½®ï¼Œç¼“å­˜ S3 å®¢æˆ·ç«¯å®ä¾‹ã€‚é…ç½®å˜æ›´æ—¶åˆ·æ–°ç¼“å­˜ã€‚

### D9: å®¢æˆ·ç«¯ç”Ÿæˆå¼‚æ­¥æµç¨‹ä¸è‡ªåŠ¨å­˜å‚¨

**å†³ç­–**ï¼šå®¢æˆ·ç«¯ç”Ÿæˆé‡‡ç”¨"å¼‚æ­¥ç”Ÿæˆ + è‡ªåŠ¨å­˜å‚¨ + å‰ç«¯è½®è¯¢"æ¨¡å¼ï¼Œè§£å†³æ‰‹åŠ¨ä¿å­˜ä¸åç«¯è‡ªåŠ¨ä¸Šä¼ çš„çŸ›ç›¾ã€‚

**æ ¸å¿ƒæµç¨‹**ï¼š

```text
POST /api/v1/sora/generate
  â”‚
  â”œâ”€ 1. é…é¢é¢„æ£€æŸ¥ï¼ˆæœ‰æ•ˆé…é¢ > 0 æ—¶æ£€æŸ¥ï¼‰
  â”œâ”€ 2. åˆ›å»º sora_generations è®°å½•ï¼ˆstatus=pendingï¼‰
  â”œâ”€ 3. ç«‹å³è¿”å› { generation_id } ç»™å‰ç«¯ï¼ˆå¼‚æ­¥ç»§ç»­ï¼‰
  â”‚
  â”œâ”€ 4. åå°ï¼šè°ƒç”¨ Forward() è·å–ä¸Šæ¸¸åª’ä½“ URL
  â”œâ”€ 5. åå°ï¼šè‡ªåŠ¨ä¸Šä¼ åˆ° S3ï¼ˆè‹¥å¯ç”¨ä¸”é…é¢è¶³å¤Ÿï¼‰
  â”‚      â””â”€ S3 å¤±è´¥ â†’ é™çº§æœ¬åœ° â†’ å†å¤±è´¥ â†’ ä¿ç•™ä¸Šæ¸¸ URL
  â”œâ”€ 6. åå°ï¼šæ›´æ–° sora_generations è®°å½•ï¼ˆstatus/media_url/storage_type ç­‰ï¼‰
  â””â”€ 7. åå°ï¼šç´¯åŠ å­˜å‚¨é…é¢ï¼ˆä»… S3/æœ¬åœ°å­˜å‚¨æ—¶ï¼‰
```

**å‰ç«¯çŠ¶æ€åŒæ­¥**ï¼š
- å‰ç«¯é€šè¿‡è½®è¯¢ `GET /api/v1/sora/generations/:id` è·å–çŠ¶æ€æ›´æ–°
- è½®è¯¢ç­–ç•¥ï¼ˆé€’å‡é¢‘ç‡é¿å…æœåŠ¡ç«¯å‹åŠ›ï¼‰ï¼š
  - 0-2 åˆ†é’Ÿï¼šæ¯ 3 ç§’
  - 2-10 åˆ†é’Ÿï¼šæ¯ 10 ç§’
  - 10-30 åˆ†é’Ÿï¼šæ¯ 30 ç§’
  - è¶…è¿‡ 30 åˆ†é’Ÿï¼šæç¤º"ç”Ÿæˆæ—¶é—´å¼‚å¸¸ï¼Œå¯èƒ½å·²è¶…æ—¶"
- é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è°ƒç”¨ `GET /api/v1/sora/generations?status=pending,generating` æ¢å¤æ‰€æœ‰è¿›è¡Œä¸­ä»»åŠ¡

**å®Œæˆåçš„ UI çŠ¶æ€**ï¼š
- `storage_type = 's3'`ï¼ˆè‡ªåŠ¨ä¿å­˜æˆåŠŸï¼‰ï¼šæ˜¾ç¤º "âœ“ å·²ä¿å­˜åˆ°äº‘ç«¯" + "ğŸ“¥ æœ¬åœ°ä¸‹è½½"
- `storage_type = 'local'`ï¼ˆé™çº§æœ¬åœ°ï¼‰ï¼šæ˜¾ç¤º "âœ“ å·²ä¿å­˜åˆ°æœ¬åœ°" + "ğŸ“¥ æœ¬åœ°ä¸‹è½½"
- `storage_type = 'upstream'`ï¼ˆS3 ä¸å¯ç”¨ï¼‰ï¼šæ˜¾ç¤º "ğŸ“¥ æœ¬åœ°ä¸‹è½½" + è¿‡æœŸå€’è®¡æ—¶ï¼ˆ15 åˆ†é’Ÿï¼‰
  - è‹¥ S3 åç»­å¯ç”¨ï¼Œç”¨æˆ·å¯æ‰‹åŠ¨ç‚¹å‡» "â˜ï¸ ä¿å­˜åˆ°å­˜å‚¨"ï¼ˆè°ƒç”¨ `POST /api/v1/sora/generations/:id/save`ï¼‰

**å¤šä»»åŠ¡å¹¶å‘**ï¼š
- å…è®¸ç”¨æˆ·åŒæ—¶å‘èµ·æœ€å¤š 3 ä¸ªç”Ÿæˆä»»åŠ¡ï¼ˆè¶…å‡ºæ’é˜Ÿç­‰å¾…ï¼‰
- ç”Ÿæˆé¡µä¸­é—´åŒºåŸŸä»¥æ—¶é—´çº¿æ–¹å¼çºµå‘æ’åˆ—æ‰€æœ‰æ´»è·ƒä»»åŠ¡å¡ç‰‡ï¼Œæœ€æ–°åœ¨æœ€ä¸Šæ–¹
- åº•éƒ¨åˆ›ä½œæ æ˜¾ç¤ºå½“å‰æ´»è·ƒä»»åŠ¡æ•°ï¼ˆå¦‚ "æ­£åœ¨ç”Ÿæˆ 2/3"ï¼‰

**ç†ç”±**ï¼š
- å¼‚æ­¥è¿”å›è®©ç”¨æˆ·ç«‹å³å¾—åˆ°åé¦ˆï¼ˆä¸ç”¨åŒæ­¥ç­‰ 5-20 åˆ†é’Ÿï¼‰
- è‡ªåŠ¨å­˜å‚¨é¿å…ä¸Šæ¸¸ URL è¿‡æœŸå¯¼è‡´ä½œå“ä¸¢å¤±ï¼ˆç”¨æˆ·æ— éœ€æ‰‹åŠ¨æ“ä½œï¼‰
- ä¸æƒ³è¦çš„ä½œå“å¯åœ¨ä½œå“åº“ä¸­åˆ é™¤ä»¥é‡Šæ”¾é…é¢
- è½®è¯¢è€Œé WebSocketï¼Œå› ä¸ºç”Ÿæˆé—´éš”ä»¥ç§’è®¡ï¼Œè½®è¯¢è¶³å¤Ÿä¸”å®ç°ç®€å•

### D10: å–æ¶ˆç”Ÿæˆä¸æµè§ˆå™¨é€šçŸ¥

**å†³ç­–**ï¼šæ”¯æŒå–æ¶ˆè¿›è¡Œä¸­çš„ç”Ÿæˆä»»åŠ¡ï¼Œå¹¶åœ¨ä»»åŠ¡å®Œæˆæ—¶é€šè¿‡æµè§ˆå™¨é€šçŸ¥å‘ŠçŸ¥ç”¨æˆ·ã€‚

**å–æ¶ˆç”Ÿæˆ**ï¼š
- è¿›åº¦å¡ç‰‡æ˜¾ç¤º"å–æ¶ˆ"æŒ‰é’®ï¼ˆå¸¦äºŒæ¬¡ç¡®è®¤ï¼‰
- åç«¯ `POST /api/v1/sora/generations/:id/cancel`ï¼šæ ‡è®°çŠ¶æ€ä¸º `cancelled`
- è‹¥ä¸Šæ¸¸ä»»åŠ¡å·²æäº¤ä½†æ— æ³•çœŸæ­£å–æ¶ˆï¼Œåç«¯ä»æ ‡è®°ä¸º cancelled å¹¶å¿½ç•¥åç»­ç»“æœ
- å–æ¶ˆçš„ä»»åŠ¡ä¸ç´¯åŠ å­˜å‚¨é…é¢

**æµè§ˆå™¨é€šçŸ¥**ï¼š
- é¦–æ¬¡ä½¿ç”¨æ—¶è¯·æ±‚ Notification API æƒé™
- ä»»åŠ¡å®Œæˆæ—¶å‘é€æ¡Œé¢é€šçŸ¥ï¼š"æ‚¨çš„è§†é¢‘/å›¾ç‰‡å·²ç”Ÿæˆå®Œæˆï¼"
- ä»»åŠ¡å¤±è´¥æ—¶é€šçŸ¥ï¼š"ç”Ÿæˆå¤±è´¥ï¼š{ç®€çŸ­åŸå› }"
- æ ‡ç­¾é¡µ title é—ªçƒæç¤ºï¼ˆå¦‚ "(1) âœ“ ç”Ÿæˆå®Œæˆ - Sora"ï¼‰

### D11: Sora é¡µé¢åµŒå…¥å…¨å±€ä¾§è¾¹æ å¸ƒå±€

**å†³ç­–**ï¼šSora å®¢æˆ·ç«¯é¡µé¢ä½œä¸ºæ™®é€šç”¨æˆ·é¡µé¢åµŒå…¥å…¨å±€ä¾§è¾¹æ å¸ƒå±€å†…ï¼Œä¸ç‹¬ç«‹æ¥ç®¡å…¨å±ã€‚

**é—®é¢˜**ï¼šSora å®˜æ–¹å®¢æˆ·ç«¯æœ‰ç‹¬ç«‹çš„é¡¶éƒ¨å¯¼èˆªæ ï¼ˆLogo + Tab + é…é¢ + å¤´åƒï¼‰ï¼Œå¦‚æœåœ¨ç³»ç»Ÿå†…ä¹Ÿå®ç°ç‹¬ç«‹å¯¼èˆªæ ï¼Œä¼šä¸å…¨å±€ä¾§è¾¹æ é‡å¤ï¼ˆLogoã€å¤´åƒï¼‰ï¼Œä¸”ç”¨æˆ·æ— æ³•é€šè¿‡ä¾§è¾¹æ å¿«é€Ÿåˆ‡æ¢åˆ°å…¶ä»–é¡µé¢ã€‚

**æ–¹æ¡ˆå¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| A: å…¨å±æ¥ç®¡ï¼ˆéšè—ä¾§è¾¹æ ï¼‰ | æ²‰æµ¸å¼ä½“éªŒ | å¯¼èˆªä¸ä¸€è‡´ï¼›éœ€å®ç°è¿”å›æŒ‰é’®ï¼›ä¸ç°æœ‰é¡µé¢ä½“éªŒå‰²è£‚ |
| **âœ… B: åµŒå…¥ä¾§è¾¹æ å¸ƒå±€** | ä¸æ‰€æœ‰é¡µé¢å¯¼èˆªä¸€è‡´ | å¯ç”¨å®½åº¦ç¨å°‘ï¼ˆä¾§è¾¹æ  64/256pxï¼‰ |

é€‰æ‹© Bã€‚Sora é¡µé¢å†…ä»…ä¿ç•™ Tab åˆ‡æ¢ï¼ˆ"ç”Ÿæˆ"/"ä½œå“åº“"ï¼‰+ é…é¢è¿›åº¦æ¡ï¼Œå»æ‰ç‹¬ç«‹ Logo å’Œå¤´åƒã€‚

**ä¾§è¾¹æ èœå•é¡¹**ï¼š
- æ¡ä»¶æ˜¾ç¤ºï¼šé€šè¿‡å…¬å…±è®¾ç½® `sora_client_enabled`ï¼ˆåç«¯æ ¹æ®æ˜¯å¦æœ‰æ´»è·ƒ Sora è´¦å·æ¨æ–­ï¼‰æ§åˆ¶æ˜¾ç¤º
- å›¾æ ‡ï¼šä½¿ç”¨ Heroicons çº¿æ€§ Sparkles å›¾æ ‡ï¼ˆä¸ç°æœ‰èœå•å›¾æ ‡åŒä¸º stroke é£æ ¼ï¼‰
- ä½ç½®ï¼šæ™®é€šç”¨æˆ·åœ¨ Dashboard ä¹‹åï¼›ç®¡ç†å‘˜"æˆ‘çš„è´¦æˆ·"åœ¨ API å¯†é’¥ä¹‹å
- ç®€å•æ¨¡å¼ï¼š`hideInSimpleMode: true`
- åŒèœå•åŒæ­¥ï¼šåŒæ—¶æ·»åŠ åˆ° `userNavItems` å’Œ `personalNavItems`

**å…¬å…±è®¾ç½®**ï¼šåç«¯æ–°å¢ `sora_client_enabled` åˆ°å…¬å…±è®¾ç½® API å“åº”ä¸­ã€‚åˆ¤æ–­é€»è¾‘ï¼š`sora_client_enabled = (æ´»è·ƒ Sora è´¦å·æ•° > 0)`ã€‚å‰ç«¯é€šè¿‡ `appStore.cachedPublicSettings?.sora_client_enabled` æ¡ä»¶æ¸²æŸ“èœå•é¡¹ã€‚

## Risks / Trade-offs

### R1: aws-sdk-go-v2 æ–°ä¾èµ–å¼•å…¥

**é£é™©**ï¼šå¼•å…¥ `aws-sdk-go-v2` ä¼šå¢åŠ é¡¹ç›®çš„ä¾èµ–ä½“ç§¯ã€‚

**ç¼“è§£**ï¼šä»…å¼•å…¥å¿…è¦çš„å­æ¨¡å—ï¼ˆ`s3`ã€`config`ã€`credentials`ï¼‰ï¼Œä¸å¼•å…¥å®Œæ•´ SDKã€‚Go æ¨¡å—ç³»ç»Ÿå¯ä»¥ç²¾ç¡®æ§åˆ¶ä¾èµ–ç²’åº¦ã€‚

### R2: å¤§æ–‡ä»¶ä¸Šä¼ åˆ° S3 çš„å†…å­˜å‹åŠ›

**é£é™©**ï¼šè§†é¢‘æ–‡ä»¶å¯è¾¾ 200MBï¼Œå¦‚æœå…ˆä¸‹è½½åˆ°å†…å­˜å†ä¸Šä¼  S3ï¼Œä¼šå¯¼è‡´å†…å­˜å³°å€¼ã€‚

**ç¼“è§£**ï¼šä½¿ç”¨æµå¼ç®¡é“ â€” ä» Sora ä¸Šæ¸¸ä¸‹è½½çš„åŒæ—¶æµå¼ä¸Šä¼ åˆ° S3ï¼ˆ`io.Pipe`ï¼‰ï¼Œé¿å…å…¨é‡ç¼“å­˜åˆ°å†…å­˜ã€‚

### R3: é…é¢è®¡ç®—çš„å¹¶å‘ä¸€è‡´æ€§

**é£é™©**ï¼šå¤šä¸ªå¹¶å‘è¯·æ±‚åŒæ—¶æ£€æŸ¥é…é¢å¯èƒ½å¯¼è‡´è¶…é¢ã€‚

**ç¼“è§£**ï¼š
- å…ˆè®¡ç®— `effective_quota`ï¼ˆç”¨æˆ· > åˆ†ç»„ > ç³»ç»Ÿé»˜è®¤ï¼‰ï¼Œå†æ‰§è¡ŒåŸå­æ›´æ–°ï¼š
  `UPDATE users SET sora_storage_used_bytes = sora_storage_used_bytes + :delta WHERE id = :id AND (:effective_quota = 0 OR sora_storage_used_bytes + :delta <= :effective_quota)`
- è‹¥åŸå­æ›´æ–°å¤±è´¥åˆ™å›æ»šæ–°ä¸Šä¼ æ–‡ä»¶ï¼Œå¹¶è¿”å›é…é¢é”™è¯¯ï¼Œä¸æ¥å—è¶…é¢è½ç›˜

### R4: apikey è´¦å·é€ä¼ çš„å“åº”æ ¼å¼å·®å¼‚

**é£é™©**ï¼šä¸Šæ¸¸ sub2api è¿”å›çš„å“åº”æ ¼å¼å¯èƒ½ä¸æœ¬åœ° SDK ç›´è¿çš„æ ¼å¼ä¸å®Œå…¨ä¸€è‡´ã€‚

**ç¼“è§£**ï¼šé€ä¼ æ¨¡å¼ä¸‹ä¸åšä»»ä½•å“åº”ä½“æ”¹å†™ï¼ŒåŸæ ·è¿”å›ã€‚å®¢æˆ·ç«¯éœ€è¦å…¼å®¹ä¸¤ç§æ¥æºçš„å“åº”ã€‚

### R5: æ— å­˜å‚¨æ¨¡å¼ä¸‹çš„ç”¨æˆ·ä½“éªŒ

**é£é™©**ï¼šä¸Šæ¸¸ä¸´æ—¶ URL è¿‡æœŸæ—¶é—´ä¸ç¡®å®šï¼ˆå¯èƒ½å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰ï¼Œç”¨æˆ·å¯èƒ½æ¥ä¸åŠä¸‹è½½ã€‚

**ç¼“è§£**ï¼š
- æ­£å¸¸æ¨¡å¼ï¼ˆS3 å¯ç”¨ï¼‰ï¼šD9 çš„è‡ªåŠ¨å­˜å‚¨å½»åº•æ¶ˆé™¤æ­¤é£é™©
- é™çº§æ¨¡å¼ï¼ˆS3 ä¸å¯ç”¨ï¼‰ï¼š
  - è¿›åº¦å¡ç‰‡æ˜¾ç¤ºé†’ç›®çš„ **15 åˆ†é’Ÿå€’è®¡æ—¶è¿›åº¦æ¡**ï¼ˆ"å‰©ä½™ 12:34 å¯ä¸‹è½½"ï¼‰
  - å‰©ä½™ 5 åˆ†é’Ÿæ—¶é€šè¿‡æµè§ˆå™¨é€šçŸ¥æé†’ç”¨æˆ·
  - å‰©ä½™ 2 åˆ†é’Ÿæ—¶å¡ç‰‡è¾¹æ¡†å˜ä¸ºçº¢è‰²è­¦å‘Šæ€
  - è¿‡æœŸåæ˜¾ç¤º"é“¾æ¥å·²è¿‡æœŸï¼Œä½œå“æ— æ³•æ¢å¤"ï¼ˆç°è‰²ä¸å¯æ“ä½œï¼‰
  - ç”¨æˆ·ç¦»å¼€é¡µé¢æ—¶è§¦å‘ `beforeunload` è­¦å‘Šï¼š"æ‚¨æœ‰æœªä¸‹è½½çš„ç”Ÿæˆç»“æœï¼Œç¦»å¼€åå¯èƒ½ä¸¢å¤±"

### R6: å¤šä»»åŠ¡å¹¶å‘çš„èµ„æºæ§åˆ¶

**é£é™©**ï¼šå…è®¸å¤šä»»åŠ¡å¹¶å‘ï¼ˆD9ï¼‰å¯èƒ½å¯¼è‡´åŒä¸€ç”¨æˆ·å ç”¨è¿‡å¤šä¸Šæ¸¸å¹¶å‘æ§½ä½ã€‚

**ç¼“è§£**ï¼š
- å®¢æˆ·ç«¯å¹¶å‘ä¸Šé™ 3 ä¸ªï¼ˆè¶…å‡ºè¿”å› 429 + "è¯·ç­‰å¾…å½“å‰ä»»åŠ¡å®Œæˆ"ï¼‰
- å¤ç”¨ç°æœ‰ `SoraGatewayHandler` çš„ç”¨æˆ·çº§å¹¶å‘æ§åˆ¶ï¼ˆ`userSlots`ï¼‰
- åç«¯é™åˆ¶åŒä¸€ç”¨æˆ· pending+generating çŠ¶æ€çš„è®°å½•ä¸è¶…è¿‡ 3 æ¡

### R7: é¢„ç­¾å URL 24 å°æ—¶è¿‡æœŸå¯¼è‡´ä½œå“åº“ç¢å›¾

**é£é™©**ï¼šS3 é¢„ç­¾å URL 24 å°æ—¶åè¿‡æœŸï¼Œå¦‚æœå‰ç«¯ç¼“å­˜äº†æ—§ URLï¼Œä½œå“åº“ä¸­çš„ç¼©ç•¥å›¾å’Œè§†é¢‘ä¼šå˜æˆ broken imageã€‚

**ç¼“è§£**ï¼š
- ä½œå“åº“åˆ—è¡¨ API æ¯æ¬¡è¿”å›æ—¶ç”±åç«¯**åŠ¨æ€ç”Ÿæˆæ–°çš„é¢„ç­¾å URL**ï¼ˆæœ‰æ•ˆæœŸ 24 å°æ—¶ï¼‰
- å‰ç«¯ä¸ç¼“å­˜åª’ä½“ URLï¼Œæ¯æ¬¡æ‰“å¼€ä½œå“åº“/è¯¦æƒ…éƒ½è¯·æ±‚æ–°æ•°æ®
- é…ç½® CDN URL æ—¶æ— æ­¤é—®é¢˜ï¼ˆCDN URL æ°¸ä¹…æœ‰æ•ˆï¼‰

## Migration Plan

### é˜¶æ®µä¸€ï¼šåŸºç¡€è®¾æ–½ï¼ˆå¯ç‹¬ç«‹éƒ¨ç½²ï¼‰

1. æ•°æ®åº“è¿ç§»ï¼š`sora_generations` è¡¨ + `users` è¡¨æ–°å¢é…é¢å­—æ®µ
2. ç³»ç»Ÿè®¾ç½®æ–°å¢é»˜è®¤é…é¢é”®å€¼ + Sora S3 é…ç½®é”®å€¼
3. å¼•å…¥ `aws-sdk-go-v2` ä¾èµ–

### é˜¶æ®µäºŒï¼šåç«¯èƒ½åŠ›

4. Sora apikey è´¦å·ç±»å‹ â€” å‰ç«¯è´¦å·åˆ›å»ºè¡¨å• + åç«¯ HTTP é€ä¼ 
5. S3 ä¸Šä¼ æœåŠ¡ â€” è¯»å–ç³»ç»Ÿè®¾ç½®ä¸­çš„ S3 é…ç½®ï¼Œä½¿ç”¨ aws-sdk-go-v2 å®ç°æ–‡ä»¶ä¸Šä¼ 
6. ç”Ÿæˆè®°å½• CRUD + é…é¢ç®¡ç† Service
7. Sora Client Handler + è·¯ç”±æ³¨å†Œ

### é˜¶æ®µä¸‰ï¼šå‰ç«¯å®¢æˆ·ç«¯

8. Sora å®¢æˆ·ç«¯ UI â€” ç”Ÿæˆé¡µ + ä½œå“åº“ + è¿›åº¦ + é…é¢
9. æ— å­˜å‚¨å³æ—¶ä¸‹è½½æ¨¡å¼
10. ä¾§è¾¹æ èœå• + è·¯ç”± + å›½é™…åŒ–

### å›æ»šç­–ç•¥

- æ‰€æœ‰æ•°æ®åº“è¿ç§»éƒ½æ˜¯ additiveï¼ˆæ–°å¢è¡¨/å­—æ®µï¼‰ï¼Œä¸ä¿®æ”¹ç°æœ‰ç»“æ„
- å‰ç«¯æ–°é¡µé¢ç‹¬ç«‹äºç°æœ‰é¡µé¢ï¼Œåˆ é™¤è·¯ç”±å³å¯å›æ»š
- `/sora/v1/chat/completions` ä¸åšä»»ä½•ä¿®æ”¹ï¼ŒAPI ç”¨æˆ·æ— æ„ŸçŸ¥
- Sora S3 é…ç½®ç‹¬ç«‹äºç°æœ‰å¤‡ä»½ S3 Profileï¼Œä¸å½±å“ç°æœ‰å¤‡ä»½åŠŸèƒ½

## Open Questions

1. **è§†é¢‘ç¼©ç•¥å›¾å¦‚ä½•ç”Ÿæˆï¼Ÿ** â€” âœ… å·²å†³ç­–ï¼šå‰ç«¯ç”¨ `<video>` æ ‡ç­¾æˆªç¬¬ä¸€å¸§ï¼ˆæ— éœ€æœåŠ¡ç«¯ä¾èµ–ï¼‰
2. **é…é¢å•ä½æ˜¯å¦éœ€è¦æ›´ç»†ç²’åº¦ï¼Ÿ** â€” âœ… å·²å†³ç­–ï¼šç¬¬ä¸€ç‰ˆåªåšå­—èŠ‚æ•°ï¼Œä¸åšæ¬¡æ•°é™åˆ¶
3. **æ˜¯å¦éœ€è¦ç®¡ç†å‘˜æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·çš„ Sora ç”Ÿæˆè®°å½•ï¼Ÿ** â€” ğŸ”œ ç¬¬äºŒç‰ˆå†åšï¼Œåç»­æŒ‰éœ€æ·»åŠ 
4. **ç”ŸæˆçŠ¶æ€æ¨é€æ–¹å¼ï¼Ÿ** â€” âœ… å·²å†³ç­–ï¼ˆD9ï¼‰ï¼šä½¿ç”¨å‰ç«¯è½®è¯¢ï¼ˆé€’å‡é¢‘ç‡ï¼‰ï¼Œä¸å¼•å…¥ WebSocket
