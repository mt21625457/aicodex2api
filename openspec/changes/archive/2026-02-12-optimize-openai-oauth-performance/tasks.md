## 0. 审核签核门禁

- [x] 0.1 确认并冻结基线窗口、压测场景、流量模型与样本数据集
- [x] 0.2 确认并签核性能目标阈值（P95/P99、TTFT、错误率、CPU/内存、Redis RT）
- [x] 0.3 确认灰度策略（分批比例）与回滚触发阈值（错误率/延迟）

## 1. 基线与可观测性

- [x] 1.1 为 OpenAI OAuth `/v1/responses` 链路补齐阶段耗时指标（认证、调度、token、上游首包、SSE 处理）
- [x] 1.2 建立统一压测脚本与报告模板，输出优化前基线（P50/P95/P99、TTFT、错误率、CPU、内存、Redis RT）
- [x] 1.3 在监控中新增性能验收看板与告警阈值（重点关注 P99 与错误率）

## 2. 请求热路径优化

- [x] 2.1 收敛 handler/service 中对同一请求体的重复解析，移除可避免的全量 JSON 解析
- [x] 2.2 减少热路径中不必要的大对象拷贝与字符串转换（含 ops 上下文字段）
- [x] 2.3 为热路径优化补充回归测试，确保请求校验与兼容行为不变

## 3. 并发与调度路径优化

- [x] 3.1 调整并发流程为“先抢槽再排队”，使可立即获取槽位请求跳过等待队列写入
- [x] 3.2 将槽位释放守护逻辑改为轻量机制（如 context 生命周期回调），移除请求级守护 goroutine
- [x] 3.3 增加并发一致性验证（槽位计数、等待计数、释放成功率）与对应测试

## 4. 流式转发热路径优化

- [x] 4.1 将 SSE 行识别从正则改为低开销前缀/状态机方式
- [x] 4.2 将 usage 解析改为选择性解析（仅关键事件），降低每行 JSON 处理成本
- [x] 4.3 增加流式协议兼容测试（事件顺序、DONE 语义、异常事件）并完成样本回放验证

## 5. Token 竞争路径优化

- [x] 5.1 将 token 锁竞争等待从固定长等待改为短轮询+jitter 策略
- [x] 5.2 增加高并发 token 刷新竞争测试，验证无显著固定延迟台阶
- [x] 5.3 增加 token 刷新保护指标（刷新 QPS、锁等待分布、失败率）并配置告警

## 6. 灰度发布与验收

- [x] 6.1 按批次灰度发布（并发路径、流式路径、token 路径、热路径微优化）并记录每批收益
- [x] 6.2 在灰度期间执行阈值守护，触发条件时验证可按批次快速回滚
- [x] 6.3 完成最终验收报告，确认性能目标达成并关闭本变更
