<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sora å®¢æˆ·ç«¯ â€” åµŒå…¥å…¨å±€ä¾§è¾¹æ å¸ƒå±€</title>
<style>
/* ============================================================
   CSS å˜é‡ â€” ä¸»é¢˜è‰²ç®¡ç†
   ============================================================ */
:root {
  --bg-primary: #0D0D0D;
  --bg-secondary: #1A1A1A;
  --bg-tertiary: #242424;
  --bg-elevated: #2A2A2A;
  --bg-hover: #333333;
  --bg-input: #1E1E1E;

  --text-primary: #FFFFFF;
  --text-secondary: #A0A0A0;
  --text-tertiary: #666666;
  --text-muted: #4A4A4A;

  --accent-primary: #7C3AED;
  --accent-secondary: #6D28D9;
  --accent-gradient: linear-gradient(135deg, #7C3AED 0%, #2563EB 100%);
  --accent-gradient-hover: linear-gradient(135deg, #8B5CF6 0%, #3B82F6 100%);

  --success: #10B981;
  --warning: #F59E0B;
  --error: #EF4444;
  --info: #3B82F6;

  --border-color: #2A2A2A;
  --border-subtle: #1F1F1F;

  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 20px;
  --radius-full: 9999px;

  --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
  --shadow-lg: 0 8px 32px rgba(0,0,0,0.5);
  --shadow-glow: 0 0 20px rgba(124,58,237,0.3);

  --transition-fast: 150ms ease;
  --transition-normal: 250ms ease;
  --transition-slow: 400ms ease;

  --font-sans: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", "PingFang SC", "Noto Sans SC", sans-serif;
  --font-mono: "SF Mono", "Fira Code", "Cascadia Code", monospace;

  --header-height: 56px;
  --creator-bar-height: 180px;
  --sidebar-width: 220px;
}

/* ============================================================
   Reset & Base
   ============================================================ */
*, *::before, *::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  font-family: var(--font-sans);
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
  line-height: 1.5;
}

button {
  font-family: inherit;
  cursor: pointer;
  border: none;
  outline: none;
  background: none;
  color: inherit;
}

input, textarea, select {
  font-family: inherit;
  outline: none;
  border: none;
  background: none;
  color: inherit;
}

a {
  color: inherit;
  text-decoration: none;
}

/* ============================================================
   æ»šåŠ¨æ¡
   ============================================================ */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}
::-webkit-scrollbar-track {
  background: transparent;
}
::-webkit-scrollbar-thumb {
  background: var(--bg-hover);
  border-radius: 3px;
}
::-webkit-scrollbar-thumb:hover {
  background: var(--text-tertiary);
}

/* ============================================================
   å…¨å±€ä¾§è¾¹æ ï¼ˆæ¨¡æ‹Ÿç³»ç»Ÿä¾§è¾¹æ ï¼Œå±•ç¤º Sora åœ¨å…¨å±€å¸ƒå±€ä¸­çš„ä½ç½®ï¼‰
   ============================================================ */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: var(--sidebar-width);
  height: 100vh;
  background: #111111;
  border-right: 1px solid var(--border-subtle);
  z-index: 1100;
  display: flex;
  flex-direction: column;
  padding: 16px 0;
  overflow-y: auto;
}

.sidebar-brand {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 4px 16px 16px;
}

.sidebar-brand-logo {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  background: var(--accent-gradient);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 700;
}

.sidebar-brand-name {
  font-size: 15px;
  font-weight: 700;
}

.sidebar-section-title {
  font-size: 11px;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  padding: 16px 16px 6px;
}

.sidebar-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 16px;
  margin: 1px 8px;
  border-radius: var(--radius-sm);
  font-size: 13px;
  color: var(--text-secondary);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.sidebar-item:hover {
  background: var(--bg-secondary);
  color: var(--text-primary);
}

.sidebar-item.active {
  background: var(--bg-tertiary);
  color: var(--text-primary);
  font-weight: 500;
}

.sidebar-item svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
  stroke: currentColor;
  fill: none;
  stroke-width: 1.5;
}

.sidebar-item.active svg {
  color: var(--accent-primary);
}

.sidebar-divider {
  height: 1px;
  background: var(--border-subtle);
  margin: 8px 16px;
}

.sidebar-bottom {
  margin-top: auto;
  padding: 8px 0;
  border-top: 1px solid var(--border-subtle);
}

/* ============================================================
   é¡µé¢å†…å¯¼èˆªæ ï¼ˆåç§»ä¾§è¾¹æ å®½åº¦ï¼‰
   ============================================================ */
.header {
  position: fixed;
  top: 0;
  left: var(--sidebar-width);
  right: 0;
  height: var(--header-height);
  background: rgba(13, 13, 13, 0.85);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border-subtle);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 24px;
  z-index: 1000;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 32px;
}

/* Logo/å¤´åƒå·²ç§»é™¤ â€” ç”±å…¨å±€ä¾§è¾¹æ æä¾› */

.nav-tabs {
  display: flex;
  gap: 4px;
  background: var(--bg-secondary);
  border-radius: var(--radius-full);
  padding: 3px;
}

.nav-tab {
  padding: 6px 20px;
  border-radius: var(--radius-full);
  font-size: 13px;
  font-weight: 500;
  color: var(--text-secondary);
  transition: all var(--transition-fast);
  user-select: none;
}

.nav-tab:hover {
  color: var(--text-primary);
}

.nav-tab.active {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

.header-right {
  display: flex;
  align-items: center;
  gap: 16px;
}

/* é…é¢ä¿¡æ¯ */
.quota-info {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 6px 14px;
  background: var(--bg-secondary);
  border-radius: var(--radius-full);
  font-size: 12px;
  color: var(--text-secondary);
}

.quota-bar-wrapper {
  width: 80px;
  height: 4px;
  background: var(--bg-hover);
  border-radius: 2px;
  overflow: hidden;
}

.quota-bar-fill {
  height: 100%;
  background: var(--accent-gradient);
  border-radius: 2px;
  transition: width var(--transition-slow);
}

.quota-text {
  white-space: nowrap;
}

/* ç”Ÿæˆé˜Ÿåˆ—çŠ¶æ€æŒ‡ç¤ºå™¨ */
.queue-indicator {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: var(--bg-secondary);
  border-radius: var(--radius-full);
  font-size: 12px;
  color: var(--text-secondary);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.queue-indicator:hover {
  background: var(--bg-tertiary);
}

.queue-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--success);
  animation: pulse-dot 2s ease-in-out infinite;
}

.queue-dot.busy {
  background: var(--warning);
}

@keyframes pulse-dot {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

/* ============================================================
   ä¸»å†…å®¹åŒº
   ============================================================ */
.main-content {
  margin-top: var(--header-height);
  margin-left: var(--sidebar-width);
  min-height: calc(100vh - var(--header-height));
}

/* ============================================================
   é¡µé¢ï¼šç”Ÿæˆé¡µ
   ============================================================ */
.page {
  display: none;
  min-height: calc(100vh - var(--header-height));
}

.page.active {
  display: flex;
  flex-direction: column;
}

.generate-page {
  padding-bottom: 200px;
}

/* ä¸­é—´ä»»åŠ¡åŒºåŸŸ */
.task-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px 24px;
  gap: 24px;
  max-width: 900px;
  margin: 0 auto;
  width: 100%;
}

/* æ¬¢è¿åŒºåŸŸ */
.welcome-section {
  text-align: center;
  padding: 60px 0 40px;
}

.welcome-title {
  font-size: 36px;
  font-weight: 700;
  letter-spacing: -0.03em;
  margin-bottom: 12px;
  background: linear-gradient(135deg, #FFFFFF 0%, #A0A0A0 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.welcome-subtitle {
  font-size: 16px;
  color: var(--text-secondary);
  max-width: 480px;
  margin: 0 auto;
  line-height: 1.6;
}

/* ç¤ºä¾‹æç¤ºè¯ */
.example-prompts {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  width: 100%;
  max-width: 640px;
}

.example-prompt {
  padding: 16px 20px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  font-size: 13px;
  color: var(--text-secondary);
  cursor: pointer;
  transition: all var(--transition-fast);
  text-align: left;
  line-height: 1.5;
}

.example-prompt:hover {
  background: var(--bg-tertiary);
  border-color: var(--bg-hover);
  color: var(--text-primary);
  transform: translateY(-1px);
}

/* ============================================================
   ç”Ÿæˆè¿›åº¦å¡ç‰‡
   ============================================================ */
.task-cards {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.task-card {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 24px;
  transition: all var(--transition-normal);
}

.task-card:hover {
  border-color: var(--bg-hover);
}

.task-card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
}

.task-status {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  font-weight: 500;
}

.task-status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.task-status-dot.queued {
  background: var(--text-tertiary);
}

.task-status-dot.generating {
  background: var(--warning);
  animation: pulse-dot 1.5s ease-in-out infinite;
}

.task-status-dot.completed {
  background: var(--success);
}

.task-status-dot.failed {
  background: var(--error);
}

.task-status-label.queued { color: var(--text-secondary); }
.task-status-label.generating { color: var(--warning); }
.task-status-label.completed { color: var(--success); }
.task-status-label.failed { color: var(--error); }

.task-model-tag {
  font-size: 11px;
  padding: 3px 10px;
  background: var(--bg-tertiary);
  border-radius: var(--radius-full);
  color: var(--text-secondary);
  font-family: var(--font-mono);
}

.task-prompt {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 16px;
  line-height: 1.6;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* è¿›åº¦æ¡ */
.task-progress-wrapper {
  margin-bottom: 16px;
}

.task-progress-bar {
  width: 100%;
  height: 4px;
  background: var(--bg-hover);
  border-radius: 2px;
  overflow: hidden;
}

.task-progress-fill {
  height: 100%;
  border-radius: 2px;
  transition: width var(--transition-slow);
}

.task-progress-fill.generating {
  background: var(--accent-gradient);
  animation: progress-shimmer 2s ease-in-out infinite;
}

.task-progress-fill.completed {
  background: var(--success);
}

.task-progress-fill.failed {
  background: var(--error);
}

@keyframes progress-shimmer {
  0% { opacity: 1; }
  50% { opacity: 0.6; }
  100% { opacity: 1; }
}

.task-progress-info {
  display: flex;
  justify-content: space-between;
  margin-top: 8px;
  font-size: 12px;
  color: var(--text-tertiary);
}

/* å®ŒæˆçŠ¶æ€é¢„è§ˆ */
.task-preview {
  margin-top: 16px;
  border-radius: var(--radius-md);
  overflow: hidden;
  position: relative;
  background: var(--bg-tertiary);
}

.task-preview-image {
  width: 100%;
  height: 280px;
  object-fit: cover;
  display: block;
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
}

.task-preview-placeholder {
  width: 100%;
  height: 280px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
  font-size: 48px;
  opacity: 0.6;
}

.task-actions {
  display: flex;
  gap: 8px;
  margin-top: 16px;
}

.task-action-btn {
  padding: 8px 20px;
  border-radius: var(--radius-full);
  font-size: 13px;
  font-weight: 500;
  transition: all var(--transition-fast);
}

.task-action-btn.primary {
  background: var(--accent-gradient);
  color: white;
}

.task-action-btn.primary:hover {
  background: var(--accent-gradient-hover);
  box-shadow: var(--shadow-glow);
}

.task-action-btn.secondary {
  background: var(--bg-tertiary);
  color: var(--text-secondary);
}

.task-action-btn.secondary:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

/* æ— å­˜å‚¨æç¤º */
.no-storage-toast {
  display: none;
  position: fixed;
  top: 80px;
  right: 24px;
  background: var(--bg-elevated);
  border: 1px solid var(--warning);
  border-radius: var(--radius-md);
  padding: 14px 20px;
  font-size: 13px;
  color: var(--warning);
  z-index: 999;
  box-shadow: var(--shadow-lg);
  animation: slide-in-right 0.3s ease;
  max-width: 340px;
}

.no-storage-toast.show {
  display: flex;
  align-items: center;
  gap: 10px;
}

@keyframes slide-in-right {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

/* ============================================================
   åº•éƒ¨åˆ›ä½œæ ï¼ˆæ ¸å¿ƒï¼‰
   ============================================================ */
.creator-bar-wrapper {
  position: fixed;
  bottom: 0;
  left: var(--sidebar-width);
  right: 0;
  z-index: 900;
  background: linear-gradient(to top, var(--bg-primary) 60%, transparent 100%);
  padding: 20px 24px 24px;
  pointer-events: none;
}

.creator-bar {
  max-width: 780px;
  margin: 0 auto;
  pointer-events: all;
}

.creator-bar-inner {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-xl);
  padding: 12px 16px 12px;
  transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
}

.creator-bar-inner:focus-within {
  border-color: var(--accent-primary);
  box-shadow: 0 0 0 1px var(--accent-primary), var(--shadow-glow);
}

/* æ¨¡å‹é€‰æ‹©è¡Œ */
.creator-model-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  padding: 0 4px;
}

.model-select-wrapper {
  position: relative;
}

.model-select {
  appearance: none;
  background: var(--bg-tertiary);
  color: var(--text-primary);
  padding: 5px 28px 5px 10px;
  border-radius: var(--radius-sm);
  font-size: 12px;
  font-family: var(--font-mono);
  cursor: pointer;
  border: 1px solid transparent;
  transition: all var(--transition-fast);
}

.model-select:hover {
  border-color: var(--bg-hover);
}

.model-select:focus {
  border-color: var(--accent-primary);
}

.model-select-arrow {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
  font-size: 10px;
  color: var(--text-tertiary);
}

.no-storage-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 3px 10px;
  background: rgba(245, 158, 11, 0.1);
  border: 1px solid rgba(245, 158, 11, 0.2);
  border-radius: var(--radius-full);
  font-size: 11px;
  color: var(--warning);
}

/* è¾“å…¥æ¡† */
.creator-input-wrapper {
  position: relative;
}

.creator-textarea {
  width: 100%;
  min-height: 44px;
  max-height: 120px;
  padding: 10px 4px;
  font-size: 14px;
  color: var(--text-primary);
  background: transparent;
  resize: none;
  line-height: 1.5;
  overflow-y: auto;
}

.creator-textarea::placeholder {
  color: var(--text-muted);
}

/* åº•éƒ¨å·¥å…·è¡Œ */
.creator-tools-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 4px 4px 0;
  border-top: 1px solid var(--border-subtle);
  margin-top: 4px;
  padding-top: 10px;
}

.creator-tools-left {
  display: flex;
  align-items: center;
  gap: 6px;
}

.tool-btn {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 6px 12px;
  border-radius: var(--radius-full);
  font-size: 12px;
  color: var(--text-secondary);
  background: var(--bg-tertiary);
  transition: all var(--transition-fast);
  white-space: nowrap;
}

.tool-btn:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

.tool-btn.active {
  background: rgba(124, 58, 237, 0.15);
  color: var(--accent-primary);
  border: 1px solid rgba(124, 58, 237, 0.3);
}

.tool-btn-icon {
  font-size: 14px;
  line-height: 1;
}

.tool-divider {
  width: 1px;
  height: 20px;
  background: var(--border-color);
  margin: 0 4px;
}

/* ä¸Šä¼ æŒ‰é’® */
.upload-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border-radius: var(--radius-sm);
  background: var(--bg-tertiary);
  color: var(--text-secondary);
  font-size: 16px;
  transition: all var(--transition-fast);
}

.upload-btn:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

/* ç”ŸæˆæŒ‰é’® */
.generate-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 24px;
  background: var(--accent-gradient);
  border-radius: var(--radius-full);
  font-size: 13px;
  font-weight: 600;
  color: white;
  transition: all var(--transition-fast);
}

.generate-btn:hover {
  background: var(--accent-gradient-hover);
  box-shadow: var(--shadow-glow);
  transform: translateY(-1px);
}

.generate-btn:active {
  transform: translateY(0);
}

.generate-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.generate-btn-icon {
  font-size: 16px;
}

/* ============================================================
   é¡µé¢ï¼šä½œå“åº“
   ============================================================ */
.gallery-page {
  padding: 24px;
  padding-bottom: 40px;
}

/* ç­›é€‰æ  */
.gallery-filter-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
}

.gallery-filters {
  display: flex;
  gap: 4px;
  background: var(--bg-secondary);
  border-radius: var(--radius-full);
  padding: 3px;
}

.gallery-filter {
  padding: 6px 18px;
  border-radius: var(--radius-full);
  font-size: 13px;
  font-weight: 500;
  color: var(--text-secondary);
  transition: all var(--transition-fast);
  user-select: none;
}

.gallery-filter:hover {
  color: var(--text-primary);
}

.gallery-filter.active {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

.gallery-count {
  font-size: 13px;
  color: var(--text-tertiary);
}

/* ç½‘æ ¼å¸ƒå±€ */
.gallery-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
}

/* ä½œå“å¡ç‰‡ */
.gallery-card {
  position: relative;
  border-radius: var(--radius-md);
  overflow: hidden;
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  cursor: pointer;
  transition: all var(--transition-normal);
  group: card;
}

.gallery-card:hover {
  border-color: var(--bg-hover);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.gallery-card-thumb {
  position: relative;
  width: 100%;
  aspect-ratio: 16/9;
  overflow: hidden;
}

.gallery-card-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transition: transform var(--transition-slow);
}

.gallery-card:hover .gallery-card-image {
  transform: scale(1.05);
}

/* ç±»å‹è§’æ ‡ */
.gallery-card-badge {
  position: absolute;
  top: 8px;
  left: 8px;
  padding: 3px 8px;
  border-radius: var(--radius-sm);
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  backdrop-filter: blur(8px);
}

.gallery-card-badge.video {
  background: rgba(124, 58, 237, 0.8);
  color: white;
}

.gallery-card-badge.image {
  background: rgba(16, 185, 129, 0.8);
  color: white;
}

/* hover æ“ä½œæŒ‰é’® */
.gallery-card-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  opacity: 0;
  transition: opacity var(--transition-fast);
}

.gallery-card:hover .gallery-card-overlay {
  opacity: 1;
}

.gallery-card-action {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  color: white;
  transition: all var(--transition-fast);
}

.gallery-card-action:hover {
  background: rgba(255, 255, 255, 0.25);
  transform: scale(1.1);
}

/* è§†é¢‘æ’­æ”¾æŒ‡ç¤º */
.gallery-card-play {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  color: white;
  opacity: 0;
  transition: all var(--transition-fast);
}

.gallery-card:hover .gallery-card-play {
  opacity: 1;
}

/* è§†é¢‘æ—¶é•¿ */
.gallery-card-duration {
  position: absolute;
  bottom: 8px;
  right: 8px;
  padding: 2px 6px;
  border-radius: 4px;
  background: rgba(0, 0, 0, 0.7);
  font-size: 11px;
  font-family: var(--font-mono);
  color: white;
}

/* å¡ç‰‡åº•éƒ¨ä¿¡æ¯ */
.gallery-card-info {
  padding: 12px;
}

.gallery-card-model {
  font-size: 11px;
  font-family: var(--font-mono);
  color: var(--text-tertiary);
  margin-bottom: 4px;
}

.gallery-card-time {
  font-size: 12px;
  color: var(--text-muted);
}

/* ç©ºçŠ¶æ€ */
.gallery-empty {
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 120px 40px;
  text-align: center;
}

.gallery-empty.show {
  display: flex;
}

.gallery-empty-icon {
  font-size: 64px;
  margin-bottom: 24px;
  opacity: 0.3;
}

.gallery-empty-title {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 8px;
  color: var(--text-secondary);
}

.gallery-empty-desc {
  font-size: 14px;
  color: var(--text-tertiary);
  max-width: 360px;
  line-height: 1.6;
}

.gallery-empty-btn {
  margin-top: 24px;
  padding: 10px 28px;
  background: var(--accent-gradient);
  border-radius: var(--radius-full);
  font-size: 14px;
  font-weight: 500;
  color: white;
  transition: all var(--transition-fast);
}

.gallery-empty-btn:hover {
  box-shadow: var(--shadow-glow);
}

/* ============================================================
   ä¿å­˜åˆ°å­˜å‚¨æŒ‰é’®ï¼ˆæ¡ä»¶å¯ç”¨ï¼‰
   ============================================================ */
.task-action-btn.save-storage {
  background: linear-gradient(135deg, #10B981 0%, #059669 100%);
  color: white;
}

.task-action-btn.save-storage:hover {
  box-shadow: 0 0 16px rgba(16, 185, 129, 0.3);
}

.task-action-btn.save-storage.disabled {
  background: var(--bg-tertiary);
  color: var(--text-muted);
  cursor: not-allowed;
  opacity: 0.5;
}

.task-action-btn.save-storage.disabled:hover {
  box-shadow: none;
}

.gallery-card-action.save-storage {
  background: rgba(16, 185, 129, 0.15);
  color: #10B981;
}

.gallery-card-action.save-storage:hover {
  background: rgba(16, 185, 129, 0.3);
}

.gallery-card-action.save-storage.disabled {
  opacity: 0.35;
  cursor: not-allowed;
}

.storage-tooltip {
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 6px;
  text-align: center;
}

/* ============================================================
   ä¸‹è½½å¼¹çª—
   ============================================================ */
.download-modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(4px);
  z-index: 2000;
  align-items: center;
  justify-content: center;
}

.download-modal-overlay.show {
  display: flex;
}

.download-modal {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-xl);
  padding: 32px;
  max-width: 420px;
  width: 90%;
  text-align: center;
  animation: modal-in 0.3s ease;
}

@keyframes modal-in {
  from { transform: scale(0.95); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

.download-modal-icon {
  font-size: 48px;
  margin-bottom: 16px;
}

.download-modal-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 8px;
}

.download-modal-desc {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 24px;
  line-height: 1.6;
}

.download-modal-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
}

.download-modal-btn {
  padding: 10px 24px;
  border-radius: var(--radius-full);
  font-size: 14px;
  font-weight: 500;
  transition: all var(--transition-fast);
}

.download-modal-btn.primary {
  background: var(--accent-gradient);
  color: white;
}

.download-modal-btn.primary:hover {
  box-shadow: var(--shadow-glow);
}

.download-modal-btn.ghost {
  background: var(--bg-tertiary);
  color: var(--text-secondary);
}

.download-modal-btn.ghost:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

/* ============================================================
   å“åº”å¼
   ============================================================ */
@media (max-width: 1200px) {
  .gallery-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (max-width: 900px) {
  :root { --sidebar-width: 0px; }
  .sidebar { display: none; }

  .gallery-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .example-prompts {
    grid-template-columns: 1fr;
  }

  .header-left {
    gap: 16px;
  }

  .quota-info {
    display: none;
  }
}

@media (max-width: 600px) {
  .gallery-grid {
    grid-template-columns: 1fr;
  }

  .header {
    padding: 0 16px;
  }

  .creator-bar-wrapper {
    padding: 12px 12px 16px;
  }

  .creator-tools-left {
    flex-wrap: wrap;
    gap: 4px;
  }

  .tool-btn {
    padding: 5px 8px;
    font-size: 11px;
  }

  .welcome-title {
    font-size: 28px;
  }

  .nav-tab {
    padding: 5px 14px;
    font-size: 12px;
  }

  .gallery-page {
    padding: 16px;
  }
}

/* ============================================================
   æ¸å˜è‰²å¡ç‰‡å ä½èƒŒæ™¯
   ============================================================ */
.gradient-bg-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.gradient-bg-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
.gradient-bg-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
.gradient-bg-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
.gradient-bg-5 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
.gradient-bg-6 { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }
.gradient-bg-7 { background: linear-gradient(135deg, #fccb90 0%, #d57eeb 100%); }
.gradient-bg-8 { background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%); }

/* ============================================================
   å·¥å…·æç¤º
   ============================================================ */
.tooltip {
  position: relative;
}

.tooltip::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  padding: 4px 10px;
  background: var(--bg-elevated);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  font-size: 11px;
  color: var(--text-secondary);
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--transition-fast);
  margin-bottom: 6px;
}

.tooltip:hover::after {
  opacity: 1;
}

/* ============================================================
   è¾…åŠ©åŠ¨ç”»
   ============================================================ */
@keyframes fade-in {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

.fade-in {
  animation: fade-in 0.4s ease;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.spin {
  animation: spin 1s linear infinite;
}

/* ============================================================
   å–æ¶ˆçŠ¶æ€å¡ç‰‡
   ============================================================ */
.task-status-dot.cancelled {
  background: var(--text-tertiary);
}

.task-status-label.cancelled {
  color: var(--text-tertiary);
}

.task-card.cancelled {
  opacity: 0.6;
  border-color: var(--border-subtle);
}

.task-card.cancelled .task-prompt {
  text-decoration: line-through;
  color: var(--text-tertiary);
}

/* å–æ¶ˆæŒ‰é’®ï¼ˆç”Ÿæˆä¸­/æ’é˜Ÿä¸­å¡ç‰‡ä¸Šï¼‰ */
.task-cancel-btn {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 12px;
  border-radius: var(--radius-full);
  font-size: 12px;
  color: var(--text-secondary);
  background: var(--bg-tertiary);
  transition: all var(--transition-fast);
  cursor: pointer;
}

.task-cancel-btn:hover {
  background: rgba(239, 68, 68, 0.15);
  color: var(--error);
}

/* ============================================================
   å·²ä¿å­˜åˆ°äº‘ç«¯æ ‡ç­¾
   ============================================================ */
.saved-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 14px;
  background: rgba(16, 185, 129, 0.1);
  border: 1px solid rgba(16, 185, 129, 0.25);
  border-radius: var(--radius-full);
  font-size: 13px;
  font-weight: 500;
  color: var(--success);
}

/* ============================================================
   å€’è®¡æ—¶è¿›åº¦æ¡å’Œè­¦å‘Š
   ============================================================ */
.countdown-bar-wrapper {
  margin-top: 12px;
}

.countdown-bar {
  width: 100%;
  height: 3px;
  background: var(--bg-hover);
  border-radius: 2px;
  overflow: hidden;
}

.countdown-bar-fill {
  height: 100%;
  background: var(--warning);
  border-radius: 2px;
  transition: width 1s linear;
}

.countdown-text {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  margin-top: 6px;
  font-size: 12px;
  font-weight: 500;
  color: var(--warning);
}

/* å€’è®¡æ—¶ < 2 åˆ†é’Ÿæ—¶å¡ç‰‡è¾¹æ¡†å˜çº¢ */
.task-card.countdown-warning {
  border-color: var(--error) !important;
  box-shadow: 0 0 12px rgba(239, 68, 68, 0.15);
}

.task-card.countdown-warning .countdown-bar-fill {
  background: var(--error);
}

.task-card.countdown-warning .countdown-text {
  color: var(--error);
}

/* ============================================================
   é…é¢è¿›åº¦æ¡é¢„è­¦è‰²
   ============================================================ */
.quota-bar-fill.warning {
  background: var(--warning) !important;
}

.quota-bar-fill.danger {
  background: var(--error) !important;
}

.quota-text.warning {
  color: var(--warning);
}

.quota-text.danger {
  color: var(--error);
}

/* ============================================================
   æ´»è·ƒä»»åŠ¡è®¡æ•°æ ‡ç­¾
   ============================================================ */
.active-tasks-label {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 12px;
  background: rgba(124, 58, 237, 0.12);
  border: 1px solid rgba(124, 58, 237, 0.25);
  border-radius: var(--radius-full);
  font-size: 12px;
  font-weight: 500;
  color: var(--accent-primary);
  white-space: nowrap;
  animation: fade-in 0.3s ease;
}

.active-tasks-label .pulse-indicator {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--accent-primary);
  animation: pulse-dot 1.5s ease-in-out infinite;
}

/* ============================================================
   ç”ŸæˆæŒ‰é’® disabled + tooltip æ ·å¼
   ============================================================ */
.generate-btn.max-reached {
  opacity: 0.4;
  cursor: not-allowed;
}

.generate-btn.max-reached:hover {
  transform: none;
  box-shadow: none;
}

/* ============================================================
   å¤±è´¥å¡ç‰‡é”™è¯¯åˆ†ç±»æ ·å¼
   ============================================================ */
.task-error-category {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 10px;
  background: rgba(239, 68, 68, 0.1);
  border-radius: var(--radius-sm);
  font-size: 12px;
  color: var(--error);
  margin-bottom: 8px;
}

.task-error-message {
  font-size: 13px;
  color: var(--text-secondary);
  line-height: 1.5;
  margin-bottom: 12px;
}
</style>
</head>

<body>

<!-- ============================================================
     å…¨å±€ä¾§è¾¹æ ï¼ˆæ¨¡æ‹Ÿç³»ç»Ÿä¾§è¾¹æ ï¼Œå±•ç¤º Sora åµŒå…¥å…¨å±€å¸ƒå±€ï¼‰
     ============================================================ -->
<aside class="sidebar">
  <div class="sidebar-brand">
    <div class="sidebar-brand-logo">A</div>
    <span class="sidebar-brand-name">Sub2API</span>
  </div>

  <!-- ç®¡ç†èœå• -->
  <div class="sidebar-item">
    <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z"/></svg>
    <span>ä»ªè¡¨ç›˜</span>
  </div>
  <div class="sidebar-item">
    <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"/></svg>
    <span>è´¦å·ç®¡ç†</span>
  </div>
  <div class="sidebar-item">
    <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0"/></svg>
    <span>å…¬å‘Š</span>
  </div>
  <div class="sidebar-item">
    <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
    <span>ç³»ç»Ÿè®¾ç½®</span>
  </div>

  <div class="sidebar-divider"></div>

  <!-- æˆ‘çš„è´¦æˆ· -->
  <div class="sidebar-section-title">æˆ‘çš„è´¦æˆ·</div>
  <div class="sidebar-item">
    <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z"/></svg>
    <span>API å¯†é’¥</span>
  </div>

  <!-- Sora èœå•é¡¹ï¼ˆæ¡ä»¶æ˜¾ç¤ºï¼Œå½“å‰é«˜äº®ï¼‰ -->
  <div class="sidebar-item active" title="sora_client_enabled = true æ—¶æ˜¾ç¤º">
    <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.455 2.456L21.75 6l-1.036.259a3.375 3.375 0 00-2.455 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"/></svg>
    <span>Sora</span>
  </div>

  <div class="sidebar-item">
    <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"/></svg>
    <span>ä½¿ç”¨è®°å½•</span>
  </div>
  <div class="sidebar-item">
    <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z"/></svg>
    <span>æˆ‘çš„è®¢é˜…</span>
  </div>
  <div class="sidebar-item">
    <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 11.25v8.25a1.5 1.5 0 01-1.5 1.5H5.25a1.5 1.5 0 01-1.5-1.5v-8.25M12 4.875A2.625 2.625 0 109.375 7.5H12m0-2.625V7.5m0-2.625A2.625 2.625 0 1114.625 7.5H12m0 0V21m-8.625-9.75h18c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125h-18c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"/></svg>
    <span>å…‘æ¢</span>
  </div>
  <div class="sidebar-item">
    <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/></svg>
    <span>ä¸ªäººèµ„æ–™</span>
  </div>

  <!-- åº•éƒ¨æ“ä½œ -->
  <div class="sidebar-bottom">
    <div class="sidebar-item">
      <svg viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"/></svg>
      <span>æ·±è‰²æ¨¡å¼</span>
    </div>
  </div>
</aside>

<!-- ============================================================
     é¡µé¢å†…å¯¼èˆªæ ï¼ˆSora Tab åˆ‡æ¢ + é…é¢ï¼‰
     ============================================================ -->
<header class="header">
  <div class="header-left">
    <!-- æ— ç‹¬ç«‹ Logo/å¤´åƒï¼Œç”±å…¨å±€ä¾§è¾¹æ æä¾› -->
    <nav class="nav-tabs">
      <button class="nav-tab active" data-page="generate" onclick="switchPage('generate')">ç”Ÿæˆ</button>
      <button class="nav-tab" data-page="gallery" onclick="switchPage('gallery')">ä½œå“åº“</button>
    </nav>
  </div>
  <div class="header-right">
    <div class="quota-info" id="quotaInfo">
      <div class="quota-bar-wrapper">
        <div class="quota-bar-fill warning" id="quotaBarFill" style="width: 92%"></div>
      </div>
      <span class="quota-text warning" id="quotaText">4.6 GB / 5 GB</span>
    </div>
    <div class="queue-indicator" onclick="toggleQueuePanel()">
      <span class="queue-dot busy"></span>
      <span>2 ä¸ªä»»åŠ¡</span>
    </div>
  </div>
</header>

<!-- ============================================================
     æ— å­˜å‚¨æç¤º
     ============================================================ -->
<div class="no-storage-toast" id="noStorageToast">
  <span>âš ï¸</span>
  <span>ç®¡ç†å‘˜æœªå¼€é€šäº‘å­˜å‚¨ï¼Œç”Ÿæˆå®Œæˆåè¯·ä½¿ç”¨"æœ¬åœ°ä¸‹è½½"ä¿å­˜æ–‡ä»¶ï¼Œå¦åˆ™å°†ä¼šä¸¢å¤±ã€‚</span>
</div>

<!-- ============================================================
     ä¸»å†…å®¹
     ============================================================ -->
<main class="main-content">

  <!-- ========== ç”Ÿæˆé¡µ ========== -->
  <div class="page generate-page active" id="page-generate">
    <div class="task-area">

      <!-- æ¬¢è¿åŒºåŸŸ -->
      <div class="welcome-section" id="welcomeSection">
        <h1 class="welcome-title">å°†ä½ çš„æƒ³è±¡åŠ›å˜æˆè§†é¢‘</h1>
        <p class="welcome-subtitle">è¾“å…¥ä¸€æ®µæè¿°ï¼ŒSora å°†ä¸ºä½ åˆ›ä½œé€¼çœŸçš„è§†é¢‘æˆ–å›¾ç‰‡ã€‚å°è¯•ä»¥ä¸‹ç¤ºä¾‹å¼€å§‹åˆ›ä½œã€‚</p>
      </div>

      <!-- ç¤ºä¾‹æç¤ºè¯ -->
      <div class="example-prompts" id="examplePrompts">
        <button class="example-prompt" onclick="fillPrompt(this)">
          ä¸€åªé‡‘è‰²çš„æŸ´çŠ¬åœ¨ä¸œäº¬æ¶©è°·è¡—å¤´æ•£æ­¥ï¼Œé•œå¤´è·Ÿéšï¼Œç”µå½±æ„Ÿç”»é¢ï¼Œ4K é«˜æ¸…
        </button>
        <button class="example-prompt" onclick="fillPrompt(this)">
          æ— äººæœºèˆªæ‹è§†è§’ï¼Œå†°å²›æå…‰ä¸‹çš„å†°å·æ¹–é¢åå°„ç»¿è‰²å…‰èŠ’ï¼Œæ…¢é€Ÿæ¨è¿›
        </button>
        <button class="example-prompt" onclick="fillPrompt(this)">
          èµ›åšæœ‹å…‹é£æ ¼çš„æœªæ¥åŸå¸‚ï¼Œéœ“è™¹ç¯å€’æ˜ åœ¨é›¨åç§¯æ°´ä¸­ï¼Œå¤œæ™¯ï¼Œç”µå½±çº§è‰²å½©
        </button>
        <button class="example-prompt" onclick="fillPrompt(this)">
          æ°´å¢¨ç”»é£æ ¼ï¼Œä¸€å¶æ‰èˆŸåœ¨å±±æ°´é—´æ¼‚æ³Šï¼Œè–„é›¾ç¼­ç»•ï¼Œä¸­å›½å¤å…¸æ„å¢ƒ
        </button>
      </div>

      <!-- ç”Ÿæˆä¸­çš„ä»»åŠ¡å¡ç‰‡ -->
      <div class="task-cards" id="taskCards">

        <!-- ä»»åŠ¡å¡ç‰‡ 1ï¼šç”Ÿæˆä¸­ -->
        <div class="task-card fade-in" id="task-1" data-prompt="ä¸€åªé‡‘è‰²çš„æŸ´çŠ¬åœ¨ä¸œäº¬æ¶©è°·è¡—å¤´æ•£æ­¥ï¼Œé•œå¤´è·Ÿéšï¼Œç”µå½±æ„Ÿç”»é¢ï¼Œ4K é«˜æ¸…" data-model="sora2-landscape-10s">
          <div class="task-card-header">
            <div class="task-status">
              <span class="task-status-dot generating"></span>
              <span class="task-status-label generating">ç”Ÿæˆä¸­</span>
            </div>
            <div style="display:flex;align-items:center;gap:8px;">
              <span class="task-model-tag">sora2-landscape-10s</span>
              <button class="task-cancel-btn" onclick="cancelTask('task-1')">âœ• å–æ¶ˆ</button>
            </div>
          </div>
          <div class="task-prompt">ä¸€åªé‡‘è‰²çš„æŸ´çŠ¬åœ¨ä¸œäº¬æ¶©è°·è¡—å¤´æ•£æ­¥ï¼Œé•œå¤´è·Ÿéšï¼Œç”µå½±æ„Ÿç”»é¢ï¼Œ4K é«˜æ¸…</div>
          <div class="task-progress-wrapper">
            <div class="task-progress-bar">
              <div class="task-progress-fill generating" style="width: 65%"></div>
            </div>
            <div class="task-progress-info">
              <span>å·²ç­‰å¾… 3:42 Â· é¢„è®¡å‰©ä½™ 8 åˆ†é’Ÿ</span>
              <span></span>
            </div>
          </div>
        </div>

        <!-- ä»»åŠ¡å¡ç‰‡ 2ï¼šæ’é˜Ÿä¸­ -->
        <div class="task-card fade-in" id="task-2" data-prompt="èµ›åšæœ‹å…‹é£æ ¼çš„æœªæ¥åŸå¸‚ï¼Œéœ“è™¹ç¯å€’æ˜ åœ¨é›¨åç§¯æ°´ä¸­ï¼Œå¤œæ™¯ï¼Œç”µå½±çº§è‰²å½©" data-model="sora2-portrait-15s">
          <div class="task-card-header">
            <div class="task-status">
              <span class="task-status-dot queued"></span>
              <span class="task-status-label queued">æ’é˜Ÿä¸­</span>
            </div>
            <div style="display:flex;align-items:center;gap:8px;">
              <span class="task-model-tag">sora2-portrait-15s</span>
              <button class="task-cancel-btn" onclick="cancelTask('task-2')">âœ• å–æ¶ˆ</button>
            </div>
          </div>
          <div class="task-prompt">èµ›åšæœ‹å…‹é£æ ¼çš„æœªæ¥åŸå¸‚ï¼Œéœ“è™¹ç¯å€’æ˜ åœ¨é›¨åç§¯æ°´ä¸­ï¼Œå¤œæ™¯ï¼Œç”µå½±çº§è‰²å½©</div>
          <div class="task-progress-wrapper">
            <div class="task-progress-bar">
              <div class="task-progress-fill" style="width: 0%"></div>
            </div>
            <div class="task-progress-info">
              <span>é˜Ÿåˆ—ä¸­ç¬¬ 2 ä½</span>
              <span>ç­‰å¾…ä¸­</span>
            </div>
          </div>
        </div>

        <!-- ä»»åŠ¡å¡ç‰‡ 3ï¼šå·²å®Œæˆï¼ˆæœ‰å­˜å‚¨ â€” S3 è‡ªåŠ¨ä¿å­˜æˆåŠŸï¼‰ -->
        <div class="task-card fade-in" id="task-3">
          <div class="task-card-header">
            <div class="task-status">
              <span class="task-status-dot completed"></span>
              <span class="task-status-label completed">å·²å®Œæˆ</span>
            </div>
            <span class="task-model-tag">gpt-image-1</span>
          </div>
          <div class="task-prompt">æ°´å¢¨ç”»é£æ ¼ï¼Œä¸€å¶æ‰èˆŸåœ¨å±±æ°´é—´æ¼‚æ³Šï¼Œè–„é›¾ç¼­ç»•ï¼Œä¸­å›½å¤å…¸æ„å¢ƒ</div>
          <div class="task-preview">
            <div class="task-preview-placeholder gradient-bg-1">ğŸ¨</div>
          </div>
          <div class="task-actions" id="task3Actions">
            <!-- è‡ªåŠ¨ä¿å­˜æˆåŠŸæ—¶ï¼šç»¿è‰²å·²ä¿å­˜æ ‡ç­¾ + æœ¬åœ°ä¸‹è½½æŒ‰é’® -->
            <span class="saved-badge" id="task3SavedBadge" style="display:none;">âœ“ å·²ä¿å­˜åˆ°äº‘ç«¯</span>
            <button class="task-action-btn primary" onclick="triggerLocalDownload()">ğŸ“¥ æœ¬åœ°ä¸‹è½½</button>
            <!-- upstream è®°å½•ï¼šä¿å­˜åˆ°å­˜å‚¨æŒ‰é’®ï¼ˆS3 å¯ç”¨æ—¶å¯ç‚¹å‡»ï¼Œä¸å¯ç”¨æ—¶ç¦ç”¨ï¼‰ -->
            <button class="task-action-btn save-storage" onclick="saveToStorage()" id="task3SaveBtn">â˜ï¸ ä¿å­˜åˆ°å­˜å‚¨</button>
            <!-- æ— å­˜å‚¨æ—¶ï¼šæ˜¾ç¤ºå€’è®¡æ—¶ -->
            <span class="countdown-text" id="task3Countdown">â± å‰©ä½™ 11:28 å¯ä¸‹è½½</span>
          </div>
          <!-- æ— å­˜å‚¨å€’è®¡æ—¶è¿›åº¦æ¡ -->
          <div class="countdown-bar-wrapper" id="task3CountdownBar">
            <div class="countdown-bar">
              <div class="countdown-bar-fill" style="width: 76%"></div>
            </div>
          </div>
        </div>

        <!-- ä»»åŠ¡å¡ç‰‡ 3bï¼šå·²å®Œæˆï¼ˆæœ‰å­˜å‚¨ç‰ˆæœ¬æ¼”ç¤ºï¼‰ -->
        <div class="task-card fade-in" id="task-3b">
          <div class="task-card-header">
            <div class="task-status">
              <span class="task-status-dot completed"></span>
              <span class="task-status-label completed">å·²å®Œæˆ</span>
            </div>
            <span class="task-model-tag">sora2-landscape-10s</span>
          </div>
          <div class="task-prompt">æ— äººæœºèˆªæ‹è§†è§’ï¼Œå†°å²›æå…‰ä¸‹çš„å†°å·æ¹–é¢åå°„ç»¿è‰²å…‰èŠ’ï¼Œæ…¢é€Ÿæ¨è¿›</div>
          <div class="task-preview">
            <div class="task-preview-placeholder gradient-bg-3">ğŸ¬</div>
          </div>
          <div class="task-actions">
            <span class="saved-badge">âœ“ å·²ä¿å­˜åˆ°äº‘ç«¯</span>
            <button class="task-action-btn primary" onclick="triggerLocalDownload()">ğŸ“¥ æœ¬åœ°ä¸‹è½½</button>
          </div>
        </div>

        <!-- ä»»åŠ¡å¡ç‰‡ 4ï¼šå¤±è´¥ï¼ˆé”™è¯¯åˆ†ç±»æ˜¾ç¤ºï¼‰ -->
        <div class="task-card fade-in" id="task-4" data-prompt="èµ›åšæœ‹å…‹é£æ ¼çš„æœºæ¢°æˆ˜å£«åœ¨åŸå¸‚åºŸå¢Ÿä¸­æˆ˜æ–—ï¼Œç«ç„°å’Œçˆ†ç‚¸ç‰¹æ•ˆ" data-model="sora2-landscape-10s">
          <div class="task-card-header">
            <div class="task-status">
              <span class="task-status-dot failed"></span>
              <span class="task-status-label failed">ç”Ÿæˆå¤±è´¥</span>
            </div>
            <span class="task-model-tag">sora2-landscape-10s</span>
          </div>
          <div class="task-prompt">èµ›åšæœ‹å…‹é£æ ¼çš„æœºæ¢°æˆ˜å£«åœ¨åŸå¸‚åºŸå¢Ÿä¸­æˆ˜æ–—ï¼Œç«ç„°å’Œçˆ†ç‚¸ç‰¹æ•ˆ</div>
          <div class="task-error-category">â›” å†…å®¹ç­–ç•¥é™åˆ¶</div>
          <div class="task-error-message">æç¤ºè¯åŒ…å«æš´åŠ›ç›¸å…³å†…å®¹ï¼Œè§¦å‘äº†å®‰å…¨ç­–ç•¥ã€‚è¯·ä¿®æ”¹æç¤ºè¯ä¸­çš„ç›¸å…³æè¿°åé‡è¯•ã€‚</div>
          <div class="task-progress-wrapper">
            <div class="task-progress-bar">
              <div class="task-progress-fill failed" style="width: 100%"></div>
            </div>
          </div>
          <div class="task-actions">
            <button class="task-action-btn primary" onclick="retryTask('task-4')">ğŸ”„ é‡è¯•</button>
            <button class="task-action-btn secondary" onclick="editAndRetry('task-4')">âœï¸ ç¼–è¾‘åé‡è¯•</button>
            <button class="task-action-btn secondary" onclick="deleteTask('task-4')">ğŸ—‘ åˆ é™¤</button>
          </div>
        </div>

        <!-- ä»»åŠ¡å¡ç‰‡ 5ï¼šå·²å–æ¶ˆ -->
        <div class="task-card fade-in cancelled" id="task-5" data-prompt="æ—¥å¼åº­å›­ï¼Œç§‹å¤©çš„çº¢å¶é“ºæ»¡çŸ³æ¿è·¯ï¼Œç»†é›¨é£˜è½ï¼Œç¦…æ„æ°›å›´" data-model="sora2-portrait-15s">
          <div class="task-card-header">
            <div class="task-status">
              <span class="task-status-dot cancelled"></span>
              <span class="task-status-label cancelled">å·²å–æ¶ˆ</span>
            </div>
            <span class="task-model-tag">sora2-portrait-15s</span>
          </div>
          <div class="task-prompt">æ—¥å¼åº­å›­ï¼Œç§‹å¤©çš„çº¢å¶é“ºæ»¡çŸ³æ¿è·¯ï¼Œç»†é›¨é£˜è½ï¼Œç¦…æ„æ°›å›´</div>
          <div class="task-actions">
            <button class="task-action-btn primary" onclick="retryTask('task-5')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
            <button class="task-action-btn secondary" onclick="deleteTask('task-5')">ğŸ—‘ åˆ é™¤</button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ========== ä½œå“åº“é¡µ ========== -->
  <div class="page gallery-page" id="page-gallery">

    <!-- ç­›é€‰æ  -->
    <div class="gallery-filter-bar">
      <div class="gallery-filters">
        <button class="gallery-filter active" data-filter="all" onclick="filterGallery('all', this)">å…¨éƒ¨</button>
        <button class="gallery-filter" data-filter="video" onclick="filterGallery('video', this)">è§†é¢‘</button>
        <button class="gallery-filter" data-filter="image" onclick="filterGallery('image', this)">å›¾ç‰‡</button>
      </div>
      <span class="gallery-count" id="galleryCount">å…± 8 ä¸ªä½œå“</span>
    </div>

    <!-- ç½‘æ ¼ä½œå“ -->
    <div class="gallery-grid" id="galleryGrid">

      <!-- å¡ç‰‡ 1 - è§†é¢‘ -->
      <div class="gallery-card" data-type="video">
        <div class="gallery-card-thumb">
          <div class="gallery-card-image gradient-bg-1"></div>
          <span class="gallery-card-badge video">VIDEO</span>
          <div class="gallery-card-overlay">
            <button class="gallery-card-action" title="ä¸‹è½½" onclick="event.stopPropagation(); triggerLocalDownload()">ğŸ“¥</button>
            <button class="gallery-card-action" title="åˆ é™¤" onclick="event.stopPropagation()">ğŸ—‘</button>
          </div>
          <div class="gallery-card-play">â–¶</div>
          <span class="gallery-card-duration">0:10</span>
        </div>
        <div class="gallery-card-info">
          <div class="gallery-card-model">sora2-landscape-10s</div>
          <div class="gallery-card-time">2 åˆ†é’Ÿå‰</div>
        </div>
      </div>

      <!-- å¡ç‰‡ 2 - å›¾ç‰‡ -->
      <div class="gallery-card" data-type="image">
        <div class="gallery-card-thumb">
          <div class="gallery-card-image gradient-bg-2"></div>
          <span class="gallery-card-badge image">IMAGE</span>
          <div class="gallery-card-overlay">
            <button class="gallery-card-action" title="ä¸‹è½½" onclick="event.stopPropagation(); triggerLocalDownload()">ğŸ“¥</button>
            <button class="gallery-card-action" title="åˆ é™¤" onclick="event.stopPropagation()">ğŸ—‘</button>
          </div>
        </div>
        <div class="gallery-card-info">
          <div class="gallery-card-model">gpt-image-1</div>
          <div class="gallery-card-time">15 åˆ†é’Ÿå‰</div>
        </div>
      </div>

      <!-- å¡ç‰‡ 3 - è§†é¢‘ -->
      <div class="gallery-card" data-type="video">
        <div class="gallery-card-thumb">
          <div class="gallery-card-image gradient-bg-3"></div>
          <span class="gallery-card-badge video">VIDEO</span>
          <div class="gallery-card-overlay">
            <button class="gallery-card-action" title="ä¸‹è½½" onclick="event.stopPropagation(); triggerLocalDownload()">ğŸ“¥</button>
            <button class="gallery-card-action" title="åˆ é™¤" onclick="event.stopPropagation()">ğŸ—‘</button>
          </div>
          <div class="gallery-card-play">â–¶</div>
          <span class="gallery-card-duration">0:15</span>
        </div>
        <div class="gallery-card-info">
          <div class="gallery-card-model">sora2-portrait-15s</div>
          <div class="gallery-card-time">1 å°æ—¶å‰</div>
        </div>
      </div>

      <!-- å¡ç‰‡ 4 - è§†é¢‘ -->
      <div class="gallery-card" data-type="video">
        <div class="gallery-card-thumb">
          <div class="gallery-card-image gradient-bg-4"></div>
          <span class="gallery-card-badge video">VIDEO</span>
          <div class="gallery-card-overlay">
            <button class="gallery-card-action" title="ä¸‹è½½" onclick="event.stopPropagation(); triggerLocalDownload()">ğŸ“¥</button>
            <button class="gallery-card-action" title="åˆ é™¤" onclick="event.stopPropagation()">ğŸ—‘</button>
          </div>
          <div class="gallery-card-play">â–¶</div>
          <span class="gallery-card-duration">0:25</span>
        </div>
        <div class="gallery-card-info">
          <div class="gallery-card-model">sora2-landscape-25s</div>
          <div class="gallery-card-time">2 å°æ—¶å‰</div>
        </div>
      </div>

      <!-- å¡ç‰‡ 5 - å›¾ç‰‡ -->
      <div class="gallery-card" data-type="image">
        <div class="gallery-card-thumb">
          <div class="gallery-card-image gradient-bg-5"></div>
          <span class="gallery-card-badge image">IMAGE</span>
          <div class="gallery-card-overlay">
            <button class="gallery-card-action" title="ä¸‹è½½" onclick="event.stopPropagation(); triggerLocalDownload()">ğŸ“¥</button>
            <button class="gallery-card-action" title="åˆ é™¤" onclick="event.stopPropagation()">ğŸ—‘</button>
          </div>
        </div>
        <div class="gallery-card-info">
          <div class="gallery-card-model">gpt-image-1</div>
          <div class="gallery-card-time">3 å°æ—¶å‰</div>
        </div>
      </div>

      <!-- å¡ç‰‡ 6 - è§†é¢‘ -->
      <div class="gallery-card" data-type="video">
        <div class="gallery-card-thumb">
          <div class="gallery-card-image gradient-bg-6"></div>
          <span class="gallery-card-badge video">VIDEO</span>
          <div class="gallery-card-overlay">
            <button class="gallery-card-action" title="ä¸‹è½½" onclick="event.stopPropagation(); triggerLocalDownload()">ğŸ“¥</button>
            <button class="gallery-card-action" title="åˆ é™¤" onclick="event.stopPropagation()">ğŸ—‘</button>
          </div>
          <div class="gallery-card-play">â–¶</div>
          <span class="gallery-card-duration">0:10</span>
        </div>
        <div class="gallery-card-info">
          <div class="gallery-card-model">sora2-landscape-10s</div>
          <div class="gallery-card-time">æ˜¨å¤©</div>
        </div>
      </div>

      <!-- å¡ç‰‡ 7 - å›¾ç‰‡ -->
      <div class="gallery-card" data-type="image">
        <div class="gallery-card-thumb">
          <div class="gallery-card-image gradient-bg-7"></div>
          <span class="gallery-card-badge image">IMAGE</span>
          <div class="gallery-card-overlay">
            <button class="gallery-card-action" title="ä¸‹è½½" onclick="event.stopPropagation(); triggerLocalDownload()">ğŸ“¥</button>
            <button class="gallery-card-action" title="åˆ é™¤" onclick="event.stopPropagation()">ğŸ—‘</button>
          </div>
        </div>
        <div class="gallery-card-info">
          <div class="gallery-card-model">gpt-image-1</div>
          <div class="gallery-card-time">æ˜¨å¤©</div>
        </div>
      </div>

      <!-- å¡ç‰‡ 8 - è§†é¢‘ -->
      <div class="gallery-card" data-type="video">
        <div class="gallery-card-thumb">
          <div class="gallery-card-image gradient-bg-8"></div>
          <span class="gallery-card-badge video">VIDEO</span>
          <div class="gallery-card-overlay">
            <button class="gallery-card-action" title="ä¸‹è½½" onclick="event.stopPropagation(); triggerLocalDownload()">ğŸ“¥</button>
            <button class="gallery-card-action" title="åˆ é™¤" onclick="event.stopPropagation()">ğŸ—‘</button>
          </div>
          <div class="gallery-card-play">â–¶</div>
          <span class="gallery-card-duration">0:15</span>
        </div>
        <div class="gallery-card-info">
          <div class="gallery-card-model">sora2-portrait-15s</div>
          <div class="gallery-card-time">2 å¤©å‰</div>
        </div>
      </div>

    </div>

    <!-- ç©ºçŠ¶æ€ -->
    <div class="gallery-empty" id="galleryEmpty">
      <div class="gallery-empty-icon">ğŸ¬</div>
      <h2 class="gallery-empty-title">è¿˜æ²¡æœ‰ä»»ä½•ä½œå“</h2>
      <p class="gallery-empty-desc">ä½ çš„åˆ›ä½œæˆæœå°†ä¼šå±•ç¤ºåœ¨è¿™é‡Œã€‚å‰å¾€ç”Ÿæˆé¡µï¼Œå¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡åˆ›ä½œå§ã€‚</p>
      <button class="gallery-empty-btn" onclick="switchPage('generate')">å¼€å§‹åˆ›ä½œ</button>
    </div>

  </div>

</main>

<!-- ============================================================
     åº•éƒ¨åˆ›ä½œæ 
     ============================================================ -->
<div class="creator-bar-wrapper" id="creatorBarWrapper">
  <div class="creator-bar">
    <div class="creator-bar-inner">

      <!-- æ¨¡å‹é€‰æ‹©è¡Œ -->
      <div class="creator-model-row">
        <div class="model-select-wrapper">
          <select class="model-select" id="modelSelect" onchange="onModelChange()">
            <optgroup label="è§†é¢‘æ¨¡å‹">
              <option value="sora2-landscape-10s">sora2-landscape-10s</option>
              <option value="sora2-landscape-15s">sora2-landscape-15s</option>
              <option value="sora2-landscape-25s">sora2-landscape-25s</option>
              <option value="sora2-portrait-10s">sora2-portrait-10s</option>
              <option value="sora2-portrait-15s">sora2-portrait-15s</option>
            </optgroup>
            <optgroup label="å›¾ç‰‡æ¨¡å‹">
              <option value="gpt-image-1">gpt-image-1</option>
              <option value="gpt-image-1-hd">gpt-image-1-hd</option>
            </optgroup>
          </select>
          <span class="model-select-arrow">â–¼</span>
        </div>
        <span class="no-storage-badge" id="noStorageBadge">âš  å­˜å‚¨æœªé…ç½®</span>
      </div>

      <!-- è¾“å…¥æ¡† -->
      <div class="creator-input-wrapper">
        <textarea
          class="creator-textarea"
          id="promptInput"
          placeholder="æè¿°ä½ æƒ³è¦ç”Ÿæˆçš„è§†é¢‘æˆ–å›¾ç‰‡..."
          rows="1"
          oninput="autoResize(this); updateGenerateBtn()"
        ></textarea>
      </div>

      <!-- åº•éƒ¨å·¥å…·è¡Œ -->
      <div class="creator-tools-row">
        <div class="creator-tools-left">
          <!-- æ–¹å‘é€‰æ‹© -->
          <button class="tool-btn active" data-aspect="landscape" onclick="selectAspect(this, 'landscape')">
            <span class="tool-btn-icon">â–¬</span> æ¨ªå±
          </button>
          <button class="tool-btn" data-aspect="portrait" onclick="selectAspect(this, 'portrait')">
            <span class="tool-btn-icon">â–®</span> ç«–å±
          </button>
          <button class="tool-btn" data-aspect="square" onclick="selectAspect(this, 'square')">
            <span class="tool-btn-icon">â—»</span> æ–¹å½¢
          </button>

          <span class="tool-divider"></span>

          <!-- æ—¶é•¿é€‰æ‹© -->
          <button class="tool-btn active" data-duration="10" onclick="selectDuration(this, 10)">10s</button>
          <button class="tool-btn" data-duration="15" onclick="selectDuration(this, 15)">15s</button>
          <button class="tool-btn" data-duration="25" onclick="selectDuration(this, 25)">25s</button>

          <span class="tool-divider"></span>

          <!-- å›¾ç‰‡ä¸Šä¼  -->
          <button class="upload-btn tooltip" data-tooltip="ä¸Šä¼ å‚è€ƒå›¾ç‰‡" onclick="triggerUpload()">
            <span>ğŸ“</span>
          </button>
          <input type="file" id="fileUpload" accept="image/*" style="display:none" onchange="handleFileUpload(this)">
        </div>

        <!-- æ´»è·ƒä»»åŠ¡è®¡æ•° -->
        <span class="active-tasks-label" id="activeTasksLabel" style="display:none;">
          <span class="pulse-indicator"></span>
          <span id="activeTasksText">æ­£åœ¨ç”Ÿæˆ 1/3</span>
        </span>

        <!-- ç”ŸæˆæŒ‰é’® -->
        <button class="generate-btn" id="generateBtn" onclick="startGenerate()" disabled>
          <span class="generate-btn-icon">âœ¨</span>
          <span>ç”Ÿæˆ</span>
        </button>
      </div>

    </div>
  </div>
</div>

<!-- ============================================================
     ä¸‹è½½å¼¹çª—
     ============================================================ -->
<div class="download-modal-overlay" id="downloadModal" onclick="closeDownloadModal(event)">
  <div class="download-modal" onclick="event.stopPropagation()">
    <div class="download-modal-icon" id="modalIcon">ğŸ“¥</div>
    <h3 class="download-modal-title" id="modalTitle">ç«‹å³ä¸‹è½½</h3>
    <p class="download-modal-desc" id="modalDesc">å½“å‰æœªé…ç½®è¿œç¨‹å­˜å‚¨ï¼Œæ–‡ä»¶ä»…ä¸´æ—¶ä¿å­˜ã€‚è¯·ç«‹å³ä¸‹è½½ä»¥å…ä¸¢å¤±ã€‚</p>
    <div class="download-modal-actions" id="modalActions">
      <button class="download-modal-btn primary" onclick="closeDownloadModal()">ä¸‹è½½æ–‡ä»¶</button>
      <button class="download-modal-btn ghost" onclick="closeDownloadModal()">ç¨åå†è¯´</button>
    </div>
  </div>
</div>

<!-- ä¿å­˜åˆ°å­˜å‚¨æˆåŠŸ/å¤±è´¥å¼¹çª— -->
<div class="download-modal-overlay" id="storageModal" onclick="closeStorageModal(event)">
  <div class="download-modal" onclick="event.stopPropagation()">
    <div class="download-modal-icon" id="storageModalIcon">â˜ï¸</div>
    <h3 class="download-modal-title" id="storageModalTitle">ä¿å­˜åˆ°å­˜å‚¨</h3>
    <p class="download-modal-desc" id="storageModalDesc"></p>
    <div class="download-modal-actions" id="storageModalActions">
      <button class="download-modal-btn primary" onclick="closeStorageModal()">ç¡®å®š</button>
    </div>
  </div>
</div>


<!-- ============================================================
     JavaScript
     ============================================================ -->
<script>
(function() {
  'use strict';

  /* ----------------------------------------------------------
     çŠ¶æ€
     ---------------------------------------------------------- */
  const state = {
    currentPage: 'generate',
    currentAspect: 'landscape',
    currentDuration: 10,
    currentModel: 'sora2-landscape-10s',
    hasStorage: false,          // æ¨¡æ‹Ÿï¼šæ— å­˜å‚¨é…ç½®
    currentFilter: 'all',
    maxConcurrentTasks: 3,      // æœ€å¤§å¹¶å‘ä»»åŠ¡æ•°
    activeTasks: [],            // å½“å‰æ´»è·ƒä»»åŠ¡åˆ—è¡¨ï¼ˆpending/generatingï¼‰
    taskIdCounter: 10,          // ä»»åŠ¡ ID è®¡æ•°å™¨ï¼ˆé¿å…å’Œé™æ€å¡ç‰‡å†²çªï¼‰
    taskTimers: {},             // å­˜å‚¨å„ä»»åŠ¡çš„è®¡æ—¶å™¨
    countdownTimers: {},        // å­˜å‚¨å€’è®¡æ—¶è®¡æ—¶å™¨
  };

  /* ----------------------------------------------------------
     é¡µé¢åˆ‡æ¢
     ---------------------------------------------------------- */
  window.switchPage = function(page) {
    state.currentPage = page;

    // æ›´æ–° Tab é«˜äº®
    document.querySelectorAll('.nav-tab').forEach(function(tab) {
      tab.classList.toggle('active', tab.dataset.page === page);
    });

    // åˆ‡æ¢é¡µé¢
    document.querySelectorAll('.page').forEach(function(p) {
      p.classList.remove('active');
    });
    document.getElementById('page-' + page).classList.add('active');

    // ç”Ÿæˆé¡µæ‰æ˜¾ç¤ºåˆ›ä½œæ 
    var creatorBar = document.getElementById('creatorBarWrapper');
    creatorBar.style.display = page === 'generate' ? '' : 'none';
  };

  /* ----------------------------------------------------------
     æ¨¡å‹é€‰æ‹©å˜åŒ–
     ---------------------------------------------------------- */
  window.onModelChange = function() {
    var sel = document.getElementById('modelSelect');
    state.currentModel = sel.value;

    // å›¾ç‰‡æ¨¡å‹éšè—æ—¶é•¿å’Œæ–¹å‘é€‰æ‹©
    var isImage = state.currentModel.startsWith('gpt-image');
    var durationBtns = document.querySelectorAll('.tool-btn[data-duration]');
    var aspectBtns = document.querySelectorAll('.tool-btn[data-aspect]');

    durationBtns.forEach(function(btn) {
      btn.style.display = isImage ? 'none' : '';
    });

    // æ–¹å‘é€‰æ‹©åœ¨å›¾ç‰‡æ¨¡å¼ä¸‹ä¾ç„¶å¯ç”¨ä½†æ”¹label
    aspectBtns.forEach(function(btn) {
      btn.style.display = isImage ? 'none' : '';
    });

    // éšè—å¯¹åº”çš„åˆ†éš”çº¿
    var dividers = document.querySelectorAll('.tool-divider');
    if (isImage) {
      dividers.forEach(function(d) { d.style.display = 'none'; });
      // åªæ˜¾ç¤ºæœ€åä¸€ä¸ªï¼ˆä¸Šä¼ æŒ‰é’®å‰çš„ï¼‰
      if (dividers.length > 0) {
        dividers[dividers.length - 1].style.display = '';
      }
    } else {
      dividers.forEach(function(d) { d.style.display = ''; });
    }
  };

  /* ----------------------------------------------------------
     æ–¹å‘é€‰æ‹©
     ---------------------------------------------------------- */
  window.selectAspect = function(btn, aspect) {
    state.currentAspect = aspect;
    document.querySelectorAll('.tool-btn[data-aspect]').forEach(function(b) {
      b.classList.remove('active');
    });
    btn.classList.add('active');
  };

  /* ----------------------------------------------------------
     æ—¶é•¿é€‰æ‹©
     ---------------------------------------------------------- */
  window.selectDuration = function(btn, duration) {
    state.currentDuration = duration;
    document.querySelectorAll('.tool-btn[data-duration]').forEach(function(b) {
      b.classList.remove('active');
    });
    btn.classList.add('active');
  };

  /* ----------------------------------------------------------
     å¡«å……ç¤ºä¾‹æç¤ºè¯
     ---------------------------------------------------------- */
  window.fillPrompt = function(el) {
    var input = document.getElementById('promptInput');
    input.value = el.textContent.trim();
    autoResize(input);
    updateGenerateBtn();
    input.focus();
  };

  /* ----------------------------------------------------------
     è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
     ---------------------------------------------------------- */
  window.autoResize = function(el) {
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight, 120) + 'px';
  };

  /* ----------------------------------------------------------
     æ›´æ–°ç”ŸæˆæŒ‰é’®çŠ¶æ€
     ---------------------------------------------------------- */
  window.updateGenerateBtn = function() {
    var btn = document.getElementById('generateBtn');
    var input = document.getElementById('promptInput');
    var maxReached = state.activeTasks.length >= state.maxConcurrentTasks;

    if (maxReached) {
      btn.disabled = true;
      btn.classList.add('max-reached');
      btn.setAttribute('data-tooltip', 'è¯·ç­‰å¾…å½“å‰ä»»åŠ¡å®Œæˆ');
      btn.classList.add('tooltip');
    } else {
      btn.disabled = !input.value.trim();
      btn.classList.remove('max-reached');
      btn.removeAttribute('data-tooltip');
      btn.classList.remove('tooltip');
    }
  };

  /* ----------------------------------------------------------
     ä¸Šä¼ è§¦å‘
     ---------------------------------------------------------- */
  window.triggerUpload = function() {
    document.getElementById('fileUpload').click();
  };

  window.handleFileUpload = function(input) {
    if (input.files && input.files[0]) {
      // æ¨¡æ‹Ÿï¼šæ˜¾ç¤ºæ–‡ä»¶å
      var fileName = input.files[0].name;
      console.log('å·²é€‰æ‹©å‚è€ƒå›¾:', fileName);
    }
  };

  /* ----------------------------------------------------------
     å¼€å§‹ç”Ÿæˆï¼ˆæ¨¡æ‹Ÿï¼‰
     ---------------------------------------------------------- */
  window.startGenerate = function() {
    var input = document.getElementById('promptInput');
    var prompt = input.value.trim();
    if (!prompt) return;

    // æ£€æŸ¥å¹¶å‘é™åˆ¶
    if (state.activeTasks.length >= state.maxConcurrentTasks) return;

    // éšè—æ¬¢è¿åŒºåŸŸå’Œç¤ºä¾‹æç¤ºè¯
    var welcome = document.getElementById('welcomeSection');
    var examples = document.getElementById('examplePrompts');
    welcome.style.display = 'none';
    examples.style.display = 'none';

    // ç”Ÿæˆå”¯ä¸€ä»»åŠ¡ID
    var taskId = 'task-' + (++state.taskIdCounter);
    var modelTag = state.currentModel;

    // åˆ›å»ºæ–°ä»»åŠ¡å¡ç‰‡ï¼ˆç«‹å³æ˜¾ç¤º pending çŠ¶æ€ï¼‰
    var taskCards = document.getElementById('taskCards');
    var card = document.createElement('div');
    card.className = 'task-card fade-in';
    card.id = taskId;
    card.dataset.prompt = prompt;
    card.dataset.model = modelTag;

    card.innerHTML = ''
      + '<div class="task-card-header">'
      +   '<div class="task-status">'
      +     '<span class="task-status-dot generating"></span>'
      +     '<span class="task-status-label generating">ç”Ÿæˆä¸­</span>'
      +   '</div>'
      +   '<div style="display:flex;align-items:center;gap:8px;">'
      +     '<span class="task-model-tag">' + escapeHtml(modelTag) + '</span>'
      +     '<button class="task-cancel-btn" onclick="cancelTask(\'' + taskId + '\')">âœ• å–æ¶ˆ</button>'
      +   '</div>'
      + '</div>'
      + '<div class="task-prompt">' + escapeHtml(prompt) + '</div>'
      + '<div class="task-progress-wrapper">'
      +   '<div class="task-progress-bar">'
      +     '<div class="task-progress-fill generating" style="width: 0%"></div>'
      +   '</div>'
      +   '<div class="task-progress-info">'
      +     '<span>å·²ç­‰å¾… 0:00 Â· æ­£åœ¨å¯åŠ¨...</span>'
      +     '<span></span>'
      +   '</div>'
      + '</div>';

    taskCards.insertBefore(card, taskCards.firstChild);

    // æ³¨å†Œæ´»è·ƒä»»åŠ¡
    state.activeTasks.push(taskId);
    updateActiveTasksUI();

    // æ¸…ç©ºè¾“å…¥æ¡†
    input.value = '';
    autoResize(input);
    updateGenerateBtn();

    // æ¨¡æ‹Ÿå¼‚æ­¥ç”Ÿæˆè¿›åº¦
    simulateProgress(card, taskId);
  };

  function simulateProgress(card, taskId) {
    var progress = 0;
    var fill = card.querySelector('.task-progress-fill');
    var info = card.querySelector('.task-progress-info');
    var statusDot = card.querySelector('.task-status-dot');
    var statusLabel = card.querySelector('.task-status-label');
    var startTime = Date.now();

    var timer = setInterval(function() {
      // æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å·²è¢«å–æ¶ˆ
      if (!document.getElementById(taskId) || card.classList.contains('cancelled')) {
        clearInterval(timer);
        return;
      }

      progress += Math.random() * 8 + 2;
      var elapsed = Date.now() - startTime;
      var elapsedStr = formatElapsed(elapsed);

      if (progress >= 100) {
        progress = 100;
        clearInterval(timer);
        delete state.taskTimers[taskId];

        fill.style.width = '100%';
        fill.className = 'task-progress-fill completed';
        statusDot.className = 'task-status-dot completed';
        statusLabel.className = 'task-status-label completed';
        statusLabel.textContent = 'å·²å®Œæˆ';
        info.innerHTML = '<span>ç”Ÿæˆå®Œæˆ Â· è€—æ—¶ ' + elapsedStr + '</span><span></span>';

        // ç§»é™¤å–æ¶ˆæŒ‰é’®
        var cancelBtn = card.querySelector('.task-cancel-btn');
        if (cancelBtn) cancelBtn.remove();

        // æ·»åŠ é¢„è§ˆ
        var gradients = ['gradient-bg-1','gradient-bg-2','gradient-bg-3','gradient-bg-4','gradient-bg-5'];
        var randomGradient = gradients[Math.floor(Math.random() * gradients.length)];

        var preview = document.createElement('div');
        preview.className = 'task-preview';
        preview.innerHTML = '<div class="task-preview-placeholder ' + randomGradient + '">ğŸ¬</div>';
        card.appendChild(preview);

        // æ ¹æ®å­˜å‚¨çŠ¶æ€æ˜¾ç¤ºä¸åŒæŒ‰é’®
        var actions = document.createElement('div');
        actions.className = 'task-actions';

        if (state.hasStorage) {
          // S3 å¯ç”¨ â†’ è‡ªåŠ¨ä¿å­˜æˆåŠŸï¼šç»¿è‰²å·²ä¿å­˜æ ‡ç­¾ + æœ¬åœ°ä¸‹è½½
          actions.innerHTML = ''
            + '<span class="saved-badge">âœ“ å·²ä¿å­˜åˆ°äº‘ç«¯</span>'
            + '<button class="task-action-btn primary" onclick="triggerLocalDownload()">ğŸ“¥ æœ¬åœ°ä¸‹è½½</button>';
        } else {
          // S3 ä¸å¯ç”¨ â†’ upstream è®°å½•ï¼šæœ¬åœ°ä¸‹è½½ + ä¿å­˜åˆ°å­˜å‚¨(ç¦ç”¨) + å€’è®¡æ—¶
          var countdownId = 'cd-' + taskId;
          actions.innerHTML = ''
            + '<button class="task-action-btn primary" onclick="triggerLocalDownload()">ğŸ“¥ æœ¬åœ°ä¸‹è½½</button>'
            + '<button class="task-action-btn save-storage disabled" title="ç®¡ç†å‘˜æœªå¼€é€šäº‘å­˜å‚¨" onclick="saveToStorage()">â˜ï¸ ä¿å­˜åˆ°å­˜å‚¨</button>'
            + '<span class="countdown-text" id="' + countdownId + '">â± å‰©ä½™ 15:00 å¯ä¸‹è½½</span>';
          card.appendChild(actions);

          // æ·»åŠ å€’è®¡æ—¶è¿›åº¦æ¡
          var cdBarWrapper = document.createElement('div');
          cdBarWrapper.className = 'countdown-bar-wrapper';
          cdBarWrapper.id = 'cdbar-' + taskId;
          cdBarWrapper.innerHTML = '<div class="countdown-bar"><div class="countdown-bar-fill" style="width: 100%"></div></div>';
          card.appendChild(cdBarWrapper);

          // å¯åŠ¨å€’è®¡æ—¶
          startCountdown(taskId, 15 * 60);
        }

        if (!actions.parentNode) {
          card.appendChild(actions);
        }

        // ä»æ´»è·ƒä»»åŠ¡ä¸­ç§»é™¤
        removeActiveTask(taskId);

      } else {
        fill.style.width = progress.toFixed(0) + '%';
        var estRemaining = Math.ceil((100 - progress) / 8 * 0.5);
        var estStr = estRemaining > 60 ? Math.ceil(estRemaining / 60) + ' åˆ†é’Ÿ' : estRemaining + ' ç§’';
        info.innerHTML = '<span>å·²ç­‰å¾… ' + elapsedStr + ' Â· é¢„è®¡å‰©ä½™ ' + estStr + '</span><span></span>';
      }
    }, 500);

    state.taskTimers[taskId] = timer;
  }

  /* ----------------------------------------------------------
     æ ¼å¼åŒ–å·²ç­‰å¾…æ—¶é—´
     ---------------------------------------------------------- */
  function formatElapsed(ms) {
    var totalSec = Math.floor(ms / 1000);
    var min = Math.floor(totalSec / 60);
    var sec = totalSec % 60;
    return min + ':' + (sec < 10 ? '0' : '') + sec;
  }

  /* ----------------------------------------------------------
     15 åˆ†é’Ÿå€’è®¡æ—¶
     ---------------------------------------------------------- */
  function startCountdown(taskId, totalSeconds) {
    var remaining = totalSeconds;

    var timer = setInterval(function() {
      remaining--;
      if (remaining <= 0) {
        clearInterval(timer);
        delete state.countdownTimers[taskId];

        // è¿‡æœŸå¤„ç†
        var cdEl = document.getElementById('cd-' + taskId);
        if (cdEl) cdEl.textContent = 'â± å·²è¿‡æœŸï¼Œæ— æ³•ä¸‹è½½';

        var barWrapper = document.getElementById('cdbar-' + taskId);
        if (barWrapper) {
          var fill = barWrapper.querySelector('.countdown-bar-fill');
          if (fill) fill.style.width = '0%';
        }
        return;
      }

      var min = Math.floor(remaining / 60);
      var sec = remaining % 60;
      var timeStr = min + ':' + (sec < 10 ? '0' : '') + sec;
      var percent = (remaining / totalSeconds * 100).toFixed(1);

      var cdEl = document.getElementById('cd-' + taskId);
      if (cdEl) cdEl.textContent = 'â± å‰©ä½™ ' + timeStr + ' å¯ä¸‹è½½';

      var barWrapper = document.getElementById('cdbar-' + taskId);
      if (barWrapper) {
        var fill = barWrapper.querySelector('.countdown-bar-fill');
        if (fill) fill.style.width = percent + '%';
      }

      // å°äº 2 åˆ†é’Ÿæ—¶å¡ç‰‡è¾¹æ¡†å˜çº¢
      var card = document.getElementById(taskId);
      if (card) {
        if (remaining < 120) {
          card.classList.add('countdown-warning');
        } else {
          card.classList.remove('countdown-warning');
        }
      }
    }, 1000);

    state.countdownTimers[taskId] = timer;
  }

  /* ----------------------------------------------------------
     å–æ¶ˆä»»åŠ¡
     ---------------------------------------------------------- */
  window.cancelTask = function(taskId) {
    var card = document.getElementById(taskId);
    if (!card) return;

    // æ¸…é™¤è¿›åº¦è®¡æ—¶å™¨
    if (state.taskTimers[taskId]) {
      clearInterval(state.taskTimers[taskId]);
      delete state.taskTimers[taskId];
    }

    // æ›´æ–°å¡ç‰‡æ ·å¼ä¸º cancelled
    card.classList.add('cancelled');
    var statusDot = card.querySelector('.task-status-dot');
    var statusLabel = card.querySelector('.task-status-label');
    if (statusDot) statusDot.className = 'task-status-dot cancelled';
    if (statusLabel) {
      statusLabel.className = 'task-status-label cancelled';
      statusLabel.textContent = 'å·²å–æ¶ˆ';
    }

    // ç§»é™¤å–æ¶ˆæŒ‰é’®
    var cancelBtn = card.querySelector('.task-cancel-btn');
    if (cancelBtn) cancelBtn.remove();

    // ç§»é™¤è¿›åº¦æ¡
    var progressWrapper = card.querySelector('.task-progress-wrapper');
    if (progressWrapper) progressWrapper.remove();

    // æ·»åŠ é‡æ–°ç”Ÿæˆå’Œåˆ é™¤æŒ‰é’®
    var existingActions = card.querySelector('.task-actions');
    if (existingActions) existingActions.remove();

    var actions = document.createElement('div');
    actions.className = 'task-actions';
    actions.innerHTML = ''
      + '<button class="task-action-btn primary" onclick="retryTask(\'' + taskId + '\')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>'
      + '<button class="task-action-btn secondary" onclick="deleteTask(\'' + taskId + '\')">ğŸ—‘ åˆ é™¤</button>';
    card.appendChild(actions);

    // ä»æ´»è·ƒä»»åŠ¡ä¸­ç§»é™¤
    removeActiveTask(taskId);
  };

  /* ----------------------------------------------------------
     é‡è¯•ä»»åŠ¡ï¼ˆä¸€é”®ä»¥ç›¸åŒå‚æ•°é‡æ–°ç”Ÿæˆï¼‰
     ---------------------------------------------------------- */
  window.retryTask = function(taskId) {
    var card = document.getElementById(taskId);
    if (!card) return;

    var prompt = card.dataset.prompt || card.querySelector('.task-prompt').textContent;
    var model = card.dataset.model || state.currentModel;

    // åˆ é™¤æ—§å¡ç‰‡
    card.remove();

    // è®¾ç½®æ¨¡å‹
    var modelSelect = document.getElementById('modelSelect');
    if (modelSelect) modelSelect.value = model;
    state.currentModel = model;

    // å¡«å…¥ prompt å¹¶è§¦å‘ç”Ÿæˆ
    var input = document.getElementById('promptInput');
    input.value = prompt;
    autoResize(input);
    startGenerate();
  };

  /* ----------------------------------------------------------
     ç¼–è¾‘åé‡è¯•ï¼ˆå°†å‚æ•°å›å¡«åˆ°åˆ›ä½œæ ï¼‰
     ---------------------------------------------------------- */
  window.editAndRetry = function(taskId) {
    var card = document.getElementById(taskId);
    if (!card) return;

    var prompt = card.dataset.prompt || card.querySelector('.task-prompt').textContent;
    var model = card.dataset.model || state.currentModel;

    // è®¾ç½®æ¨¡å‹
    var modelSelect = document.getElementById('modelSelect');
    if (modelSelect) modelSelect.value = model;
    state.currentModel = model;

    // å›å¡« prompt
    var input = document.getElementById('promptInput');
    input.value = prompt;
    autoResize(input);
    updateGenerateBtn();
    input.focus();

    // æ»šåŠ¨åˆ°åº•éƒ¨åˆ›ä½œæ 
    input.scrollIntoView({ behavior: 'smooth', block: 'center' });
  };

  /* ----------------------------------------------------------
     åˆ é™¤ä»»åŠ¡å¡ç‰‡
     ---------------------------------------------------------- */
  window.deleteTask = function(taskId) {
    var card = document.getElementById(taskId);
    if (!card) return;

    // æ¸…é™¤è®¡æ—¶å™¨
    if (state.taskTimers[taskId]) {
      clearInterval(state.taskTimers[taskId]);
      delete state.taskTimers[taskId];
    }
    if (state.countdownTimers[taskId]) {
      clearInterval(state.countdownTimers[taskId]);
      delete state.countdownTimers[taskId];
    }

    // åŠ¨ç”»åˆ é™¤
    card.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
    card.style.opacity = '0';
    card.style.transform = 'translateY(-10px)';
    setTimeout(function() {
      card.remove();
    }, 300);

    // ä»æ´»è·ƒä»»åŠ¡ä¸­ç§»é™¤
    removeActiveTask(taskId);
  };

  /* ----------------------------------------------------------
     æ´»è·ƒä»»åŠ¡ UI æ›´æ–°
     ---------------------------------------------------------- */
  function removeActiveTask(taskId) {
    var idx = state.activeTasks.indexOf(taskId);
    if (idx > -1) state.activeTasks.splice(idx, 1);
    updateActiveTasksUI();
    updateGenerateBtn();
    updateQueueIndicator();
  }

  function updateActiveTasksUI() {
    var label = document.getElementById('activeTasksLabel');
    var text = document.getElementById('activeTasksText');
    var count = state.activeTasks.length;

    if (count > 0) {
      label.style.display = '';
      text.textContent = 'æ­£åœ¨ç”Ÿæˆ ' + count + '/' + state.maxConcurrentTasks;
    } else {
      label.style.display = 'none';
    }
  }

  function updateQueueIndicator() {
    var count = state.activeTasks.length;
    var dot = document.querySelector('.queue-dot');
    var text = document.querySelector('.queue-indicator span:last-child');

    if (count > 0) {
      dot.classList.add('busy');
      text.textContent = count + ' ä¸ªä»»åŠ¡';
    } else {
      dot.classList.remove('busy');
      text.textContent = 'ç©ºé—²';
    }
  }

  /* ----------------------------------------------------------
     é…é¢è¿›åº¦æ¡é¢œè‰²æ›´æ–°
     ---------------------------------------------------------- */
  function updateQuotaBarColor(usagePercent) {
    var fill = document.getElementById('quotaBarFill');
    var text = document.getElementById('quotaText');
    if (!fill || !text) return;

    fill.classList.remove('warning', 'danger');
    text.classList.remove('warning', 'danger');

    if (usagePercent >= 100) {
      fill.classList.add('danger');
      text.classList.add('danger');
    } else if (usagePercent >= 90) {
      fill.classList.add('warning');
      text.classList.add('warning');
    }
  }

  /* ----------------------------------------------------------
     ä½œå“åº“ç­›é€‰
     ---------------------------------------------------------- */
  window.filterGallery = function(filter, btn) {
    state.currentFilter = filter;

    // æ›´æ–°ç­›é€‰æŒ‰é’®
    document.querySelectorAll('.gallery-filter').forEach(function(f) {
      f.classList.remove('active');
    });
    btn.classList.add('active');

    // ç­›é€‰å¡ç‰‡
    var cards = document.querySelectorAll('.gallery-card');
    var visibleCount = 0;

    cards.forEach(function(card) {
      var type = card.dataset.type;
      var show = (filter === 'all') || (type === filter);
      card.style.display = show ? '' : 'none';
      if (show) visibleCount++;
    });

    // æ›´æ–°è®¡æ•°
    document.getElementById('galleryCount').textContent = 'å…± ' + visibleCount + ' ä¸ªä½œå“';

    // ç©ºçŠ¶æ€
    var emptyEl = document.getElementById('galleryEmpty');
    var gridEl = document.getElementById('galleryGrid');
    if (visibleCount === 0) {
      emptyEl.classList.add('show');
      gridEl.style.display = 'none';
    } else {
      emptyEl.classList.remove('show');
      gridEl.style.display = '';
    }
  };

  /* ----------------------------------------------------------
     æœ¬åœ°ä¸‹è½½
     ---------------------------------------------------------- */
  window.triggerLocalDownload = function() {
    // æ¨¡æ‹Ÿè§¦å‘æµè§ˆå™¨ä¸‹è½½
    document.getElementById('modalIcon').textContent = 'ğŸ“¥';
    document.getElementById('modalTitle').textContent = 'æ­£åœ¨ä¸‹è½½';
    document.getElementById('modalDesc').textContent = 'æ–‡ä»¶å·²å¼€å§‹ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè¯·åœ¨æµè§ˆå™¨ä¸‹è½½æ æŸ¥çœ‹è¿›åº¦ã€‚';
    document.getElementById('modalActions').innerHTML =
      '<button class="download-modal-btn primary" onclick="closeDownloadModal()">ç¡®å®š</button>';
    document.getElementById('downloadModal').classList.add('show');
  };

  window.showDownloadModal = function() {
    document.getElementById('modalIcon').textContent = 'ğŸ“¥';
    document.getElementById('modalTitle').textContent = 'ç«‹å³ä¸‹è½½';
    document.getElementById('modalDesc').textContent = 'å½“å‰æœªé…ç½®è¿œç¨‹å­˜å‚¨ï¼Œæ–‡ä»¶ä»…ä¸´æ—¶ä¿å­˜ã€‚è¯·ç«‹å³ä¸‹è½½ä»¥å…ä¸¢å¤±ã€‚';
    document.getElementById('modalActions').innerHTML =
      '<button class="download-modal-btn primary" onclick="closeDownloadModal()">ä¸‹è½½æ–‡ä»¶</button>' +
      '<button class="download-modal-btn ghost" onclick="closeDownloadModal()">ç¨åå†è¯´</button>';
    document.getElementById('downloadModal').classList.add('show');
  };

  window.closeDownloadModal = function(e) {
    if (e && e.target !== e.currentTarget) return;
    document.getElementById('downloadModal').classList.remove('show');
  };

  /* ----------------------------------------------------------
     ä¿å­˜åˆ°å­˜å‚¨
     ---------------------------------------------------------- */
  window.saveToStorage = function(btn) {
    if (!state.hasStorage) {
      // ç®¡ç†å‘˜æœªå¼€é€šå­˜å‚¨ï¼Œæ˜¾ç¤ºæç¤º
      document.getElementById('storageModalIcon').textContent = 'ğŸ”’';
      document.getElementById('storageModalTitle').textContent = 'å­˜å‚¨æœªå¼€é€š';
      document.getElementById('storageModalDesc').textContent = 'ç®¡ç†å‘˜å°šæœªé…ç½® S3 å­˜å‚¨æœåŠ¡ã€‚è¯·è”ç³»ç®¡ç†å‘˜åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å¼€é€š Sora S3 å­˜å‚¨ï¼Œå¼€é€šåå³å¯å°†ä½œå“æ°¸ä¹…ä¿å­˜åˆ°äº‘ç«¯ã€‚';
      document.getElementById('storageModalActions').innerHTML =
        '<button class="download-modal-btn primary" onclick="closeStorageModal()">çŸ¥é“äº†</button>';
      document.getElementById('storageModal').classList.add('show');
      return;
    }

    // æ¨¡æ‹Ÿä¿å­˜åˆ°å­˜å‚¨
    var originalText = btn.innerHTML;
    btn.innerHTML = 'â³ ä¿å­˜ä¸­...';
    btn.classList.add('disabled');

    setTimeout(function() {
      btn.innerHTML = 'âœ… å·²ä¿å­˜';
      btn.classList.add('disabled');

      // æ˜¾ç¤ºæˆåŠŸå¼¹çª—
      document.getElementById('storageModalIcon').textContent = 'âœ…';
      document.getElementById('storageModalTitle').textContent = 'å·²ä¿å­˜åˆ°å­˜å‚¨';
      document.getElementById('storageModalDesc').textContent = 'æ–‡ä»¶å·²æˆåŠŸä¸Šä¼ åˆ° S3 å­˜å‚¨ï¼Œå¯åœ¨ä½œå“åº“ä¸­æ°¸ä¹…è®¿é—®ã€‚å·²å ç”¨ 42.5 MB å­˜å‚¨ç©ºé—´ã€‚';
      document.getElementById('storageModalActions').innerHTML =
        '<button class="download-modal-btn primary" onclick="closeStorageModal()">ç¡®å®š</button>';
      document.getElementById('storageModal').classList.add('show');
    }, 1500);
  };

  window.closeStorageModal = function(e) {
    if (e && e.target !== e.currentTarget) return;
    document.getElementById('storageModal').classList.remove('show');
  };

  /* ----------------------------------------------------------
     é˜Ÿåˆ—é¢æ¿ï¼ˆç®€å•åˆ‡æ¢ï¼‰
     ---------------------------------------------------------- */
  window.toggleQueuePanel = function() {
    // ç®€å•æç¤º
    console.log('é˜Ÿåˆ—é¢æ¿åˆ‡æ¢');
  };

  /* ----------------------------------------------------------
     HTML è½¬ä¹‰
     ---------------------------------------------------------- */
  function escapeHtml(str) {
    var div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }

  /* ----------------------------------------------------------
     åˆå§‹åŒ–
     ---------------------------------------------------------- */
  function init() {
    // æ— å­˜å‚¨æ¨¡å¼æç¤º
    if (!state.hasStorage) {
      var badge = document.getElementById('noStorageBadge');
      badge.style.display = '';

      // task-3 æ— å­˜å‚¨ï¼šæ˜¾ç¤ºå€’è®¡æ—¶å’Œä¿å­˜æŒ‰é’®ï¼ˆç¦ç”¨ï¼‰ï¼Œéšè—å·²ä¿å­˜æ ‡ç­¾
      var task3SavedBadge = document.getElementById('task3SavedBadge');
      if (task3SavedBadge) task3SavedBadge.style.display = 'none';
      var task3SaveBtn = document.getElementById('task3SaveBtn');
      if (task3SaveBtn) {
        task3SaveBtn.style.display = '';
        task3SaveBtn.classList.add('disabled');
        task3SaveBtn.title = 'ç®¡ç†å‘˜æœªå¼€é€šäº‘å­˜å‚¨';
      }
      var task3Countdown = document.getElementById('task3Countdown');
      if (task3Countdown) task3Countdown.style.display = '';
      var task3CountdownBar = document.getElementById('task3CountdownBar');
      if (task3CountdownBar) task3CountdownBar.style.display = '';

      // ä¸ºé™æ€ task-3 å¯åŠ¨å€’è®¡æ—¶ï¼ˆæ¨¡æ‹Ÿå·²è¿‡å»éƒ¨åˆ†æ—¶é—´ï¼‰
      startCountdown('task-3', 11 * 60 + 28);

      // 3ç§’åæ˜¾ç¤ºä¸€æ¬¡ toast
      setTimeout(function() {
        var toast = document.getElementById('noStorageToast');
        toast.classList.add('show');
        setTimeout(function() {
          toast.classList.remove('show');
        }, 5000);
      }, 1500);
    } else {
      document.getElementById('noStorageBadge').style.display = 'none';

      // task-3 æœ‰å­˜å‚¨ï¼ˆè‡ªåŠ¨ä¿å­˜æˆåŠŸï¼‰ï¼šæ˜¾ç¤ºå·²ä¿å­˜æ ‡ç­¾ï¼Œéšè—ä¿å­˜æŒ‰é’®å’Œå€’è®¡æ—¶
      var task3SavedBadge = document.getElementById('task3SavedBadge');
      if (task3SavedBadge) task3SavedBadge.style.display = '';
      var task3SaveBtn = document.getElementById('task3SaveBtn');
      if (task3SaveBtn) task3SaveBtn.style.display = 'none';
      var task3Countdown = document.getElementById('task3Countdown');
      if (task3Countdown) task3Countdown.style.display = 'none';
      var task3CountdownBar = document.getElementById('task3CountdownBar');
      if (task3CountdownBar) task3CountdownBar.style.display = 'none';
    }

    // é…é¢è¿›åº¦æ¡é¢œè‰²
    updateQuotaBarColor(92);

    // æ¨¡æ‹Ÿç¬¬ä¸€ä¸ªä»»åŠ¡çš„è¿›åº¦åŠ¨ç”»
    simulateExistingTask();

    // é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', function(e) {
      // Ctrl/Cmd + Enter è§¦å‘ç”Ÿæˆ
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        var input = document.getElementById('promptInput');
        if (document.activeElement === input && input.value.trim()) {
          e.preventDefault();
          startGenerate();
        }
      }
      // ESC å…³é—­å¼¹çª—
      if (e.key === 'Escape') {
        closeDownloadModal();
        closeStorageModal();
      }
    });
  }

  function simulateExistingTask() {
    var card = document.getElementById('task-1');
    if (!card) return;

    // æ³¨å†Œä¸ºæ´»è·ƒä»»åŠ¡
    state.activeTasks.push('task-1');
    state.activeTasks.push('task-2');
    updateActiveTasksUI();
    updateQueueIndicator();

    var fill = card.querySelector('.task-progress-fill');
    var info = card.querySelector('.task-progress-info');
    var statusDot = card.querySelector('.task-status-dot');
    var statusLabel = card.querySelector('.task-status-label');
    var progress = 65;
    var elapsedSec = 222; // æ¨¡æ‹Ÿå·²ç­‰å¾… 3:42

    var timer = setInterval(function() {
      // æ£€æŸ¥æ˜¯å¦è¢«å–æ¶ˆ
      if (card.classList.contains('cancelled')) {
        clearInterval(timer);
        return;
      }

      progress += Math.random() * 5 + 1;
      elapsedSec += 1;
      var elapsedStr = Math.floor(elapsedSec / 60) + ':' + (elapsedSec % 60 < 10 ? '0' : '') + (elapsedSec % 60);

      if (progress >= 100) {
        progress = 100;
        clearInterval(timer);

        fill.style.width = '100%';
        fill.className = 'task-progress-fill completed';
        statusDot.className = 'task-status-dot completed';
        statusLabel.className = 'task-status-label completed';
        statusLabel.textContent = 'å·²å®Œæˆ';
        info.innerHTML = '<span>ç”Ÿæˆå®Œæˆ Â· è€—æ—¶ ' + elapsedStr + '</span><span></span>';

        // ç§»é™¤å–æ¶ˆæŒ‰é’®
        var cancelBtn = card.querySelector('.task-cancel-btn');
        if (cancelBtn) cancelBtn.remove();

        // æ·»åŠ é¢„è§ˆ
        var preview = document.createElement('div');
        preview.className = 'task-preview';
        preview.innerHTML = '<div class="task-preview-placeholder gradient-bg-3">ğŸ¬</div>';
        card.appendChild(preview);

        // æ ¹æ®å­˜å‚¨çŠ¶æ€æ˜¾ç¤ºæŒ‰é’®
        var actions = document.createElement('div');
        actions.className = 'task-actions';

        if (state.hasStorage) {
          actions.innerHTML = ''
            + '<span class="saved-badge">âœ“ å·²ä¿å­˜åˆ°äº‘ç«¯</span>'
            + '<button class="task-action-btn primary" onclick="triggerLocalDownload()">ğŸ“¥ æœ¬åœ°ä¸‹è½½</button>';
        } else {
          actions.innerHTML = ''
            + '<button class="task-action-btn primary" onclick="triggerLocalDownload()">ğŸ“¥ æœ¬åœ°ä¸‹è½½</button>'
            + '<button class="task-action-btn save-storage disabled" title="ç®¡ç†å‘˜æœªå¼€é€šäº‘å­˜å‚¨" onclick="saveToStorage()">â˜ï¸ ä¿å­˜åˆ°å­˜å‚¨</button>'
            + '<span class="countdown-text" id="cd-task-1">â± å‰©ä½™ 15:00 å¯ä¸‹è½½</span>';
          card.appendChild(actions);

          var cdBarWrapper = document.createElement('div');
          cdBarWrapper.className = 'countdown-bar-wrapper';
          cdBarWrapper.id = 'cdbar-task-1';
          cdBarWrapper.innerHTML = '<div class="countdown-bar"><div class="countdown-bar-fill" style="width: 100%"></div></div>';
          card.appendChild(cdBarWrapper);

          startCountdown('task-1', 15 * 60);
        }

        if (!actions.parentNode) {
          card.appendChild(actions);
        }

        // ä»æ´»è·ƒä»»åŠ¡ç§»é™¤
        removeActiveTask('task-1');

        // ç„¶åæ¨¡æ‹Ÿç¬¬äºŒä¸ªä»»åŠ¡å¼€å§‹
        setTimeout(function() { simulateQueuedTask(); }, 1000);

      } else {
        fill.style.width = progress.toFixed(0) + '%';
        var estRemaining = Math.ceil((100 - progress) / 4);
        var estStr = estRemaining > 60 ? Math.ceil(estRemaining / 60) + ' åˆ†é’Ÿ' : estRemaining + ' ç§’';
        info.innerHTML = '<span>å·²ç­‰å¾… ' + elapsedStr + ' Â· é¢„è®¡å‰©ä½™ ' + estStr + '</span><span></span>';
      }
    }, 800);

    state.taskTimers['task-1'] = timer;
  }

  function simulateQueuedTask() {
    var card = document.getElementById('task-2');
    if (!card || card.classList.contains('cancelled')) return;

    var fill = card.querySelector('.task-progress-fill');
    var info = card.querySelector('.task-progress-info');
    var statusDot = card.querySelector('.task-status-dot');
    var statusLabel = card.querySelector('.task-status-label');

    // åˆ‡æ¢ä¸ºç”Ÿæˆä¸­
    statusDot.className = 'task-status-dot generating';
    statusLabel.className = 'task-status-label generating';
    statusLabel.textContent = 'ç”Ÿæˆä¸­';

    var progress = 0;
    var elapsedSec = 0;

    var timer = setInterval(function() {
      if (card.classList.contains('cancelled')) {
        clearInterval(timer);
        return;
      }

      progress += Math.random() * 6 + 2;
      elapsedSec += 1;
      var elapsedStr = Math.floor(elapsedSec / 60) + ':' + (elapsedSec % 60 < 10 ? '0' : '') + (elapsedSec % 60);

      if (progress >= 100) {
        progress = 100;
        clearInterval(timer);
        delete state.taskTimers['task-2'];

        fill.style.width = '100%';
        fill.className = 'task-progress-fill completed';
        statusDot.className = 'task-status-dot completed';
        statusLabel.className = 'task-status-label completed';
        statusLabel.textContent = 'å·²å®Œæˆ';
        info.innerHTML = '<span>ç”Ÿæˆå®Œæˆ Â· è€—æ—¶ ' + elapsedStr + '</span><span></span>';

        // ç§»é™¤å–æ¶ˆæŒ‰é’®
        var cancelBtn = card.querySelector('.task-cancel-btn');
        if (cancelBtn) cancelBtn.remove();

        var preview = document.createElement('div');
        preview.className = 'task-preview';
        preview.innerHTML = '<div class="task-preview-placeholder gradient-bg-5">ğŸ¬</div>';
        card.appendChild(preview);

        // æ ¹æ®å­˜å‚¨çŠ¶æ€æ˜¾ç¤ºæŒ‰é’®
        var actions = document.createElement('div');
        actions.className = 'task-actions';

        if (state.hasStorage) {
          actions.innerHTML = ''
            + '<span class="saved-badge">âœ“ å·²ä¿å­˜åˆ°äº‘ç«¯</span>'
            + '<button class="task-action-btn primary" onclick="triggerLocalDownload()">ğŸ“¥ æœ¬åœ°ä¸‹è½½</button>';
        } else {
          actions.innerHTML = ''
            + '<button class="task-action-btn primary" onclick="triggerLocalDownload()">ğŸ“¥ æœ¬åœ°ä¸‹è½½</button>'
            + '<button class="task-action-btn save-storage disabled" title="ç®¡ç†å‘˜æœªå¼€é€šäº‘å­˜å‚¨" onclick="saveToStorage()">â˜ï¸ ä¿å­˜åˆ°å­˜å‚¨</button>'
            + '<span class="countdown-text" id="cd-task-2">â± å‰©ä½™ 15:00 å¯ä¸‹è½½</span>';
          card.appendChild(actions);

          var cdBarWrapper = document.createElement('div');
          cdBarWrapper.className = 'countdown-bar-wrapper';
          cdBarWrapper.id = 'cdbar-task-2';
          cdBarWrapper.innerHTML = '<div class="countdown-bar"><div class="countdown-bar-fill" style="width: 100%"></div></div>';
          card.appendChild(cdBarWrapper);

          startCountdown('task-2', 15 * 60);
        }

        if (!actions.parentNode) {
          card.appendChild(actions);
        }

        // ä»æ´»è·ƒä»»åŠ¡ç§»é™¤
        removeActiveTask('task-2');

      } else {
        fill.style.width = progress.toFixed(0) + '%';
        fill.className = 'task-progress-fill generating';
        var estRemaining = Math.ceil((100 - progress) / 5);
        var estStr = estRemaining > 60 ? Math.ceil(estRemaining / 60) + ' åˆ†é’Ÿ' : estRemaining + ' ç§’';
        info.innerHTML = '<span>å·²ç­‰å¾… ' + elapsedStr + ' Â· é¢„è®¡å‰©ä½™ ' + estStr + '</span><span></span>';
      }
    }, 600);

    state.taskTimers['task-2'] = timer;
  }

  // å¯åŠ¨
  init();

})();
</script>

</body>
</html>