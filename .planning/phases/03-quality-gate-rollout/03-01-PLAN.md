---
phase: 03-quality-gate-rollout
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/internal/handler/admin/account_handler_passthrough_test.go
  - backend/internal/service/admin_service_bulk_update_test.go
  - frontend/src/components/account/__tests__/bulkEditPayload.spec.ts
  - docs/openai-bulk-edit-uat.md
autonomous: true
requirements:
  - BULK-08
user_setup: []
must_haves:
  truths:
    - 新增后端校验和字段通路均有自动化测试覆盖
    - 前端批量 payload 逻辑关键分支可自动验证
    - 存在可复用的手工 UAT 清单
  artifacts:
    - backend/internal/handler/admin/account_handler_passthrough_test.go
    - backend/internal/service/admin_service_bulk_update_test.go
    - frontend/src/components/account/__tests__/bulkEditPayload.spec.ts
    - docs/openai-bulk-edit-uat.md
  key_links:
    - backend bulk validation branch -> go tests
    - frontend payload builder branch -> vitest cases
    - feature behavior -> UAT checklist
---

<objective>
完成该功能的质量门禁收尾，确保上线前有自动化测试和手工验收标准。

Purpose: 降低批量配置类功能的回归风险。
Output: 测试通过证据 + UAT 文档。
</objective>

<execution_context>
@/Users/yangjianbo/.codex/get-shit-done/workflows/execute-plan.md
@/Users/yangjianbo/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-quality-gate-rollout/03-CONTEXT.md

@backend/internal/handler/admin/account_handler_passthrough_test.go
@backend/internal/service/admin_service_bulk_update_test.go
@frontend/src/components/account/BulkEditAccountModal.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add backend tests for guardrails and new bulk field</name>
  <files>backend/internal/handler/admin/account_handler_passthrough_test.go, backend/internal/service/admin_service_bulk_update_test.go</files>
  <action>新增或更新测试，覆盖 OpenAI 专属字段混选拒绝、同类型通过、auto_pause_on_expired 批量更新路径。确保错误信息和成功计数符合调用方预期。</action>
  <verify><automated>cd backend && go test ./internal/handler/admin ./internal/service -count=1</automated></verify>
  <done>关键 guardrail 与字段写入分支均被测试命中。</done>
</task>

<task type="auto">
  <name>Task 2: Add frontend unit tests for bulk payload builder behavior</name>
  <files>frontend/src/components/account/__tests__/bulkEditPayload.spec.ts, frontend/src/components/account/BulkEditAccountModal.vue</files>
  <action>为批量 payload 构建逻辑增加单测：未勾选不发送、开启发送 true/mode、关闭发送 false/off、OAuth 才发送 codex_cli_only。必要时将 payload 组装提取为可测函数。</action>
  <verify><automated>cd frontend && pnpm test:run src/components/account/__tests__/bulkEditPayload.spec.ts</automated></verify>
  <done>payload 关键分支有可重复自动化验证。</done>
</task>

<task type="auto">
  <name>Task 3: Produce rollout UAT checklist</name>
  <files>docs/openai-bulk-edit-uat.md</files>
  <action>编写最小可执行 UAT：成功场景、失败场景、回滚场景、跨页选择注意事项、问题定位指引。保证 QA/运维能直接复用。</action>
  <verify><automated>rg -n "场景|预期|回滚|混选" docs/openai-bulk-edit-uat.md</automated></verify>
  <done>UAT 文档可直接用于上线前验收。</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [x] `cd backend && go test ./internal/handler/admin ./internal/service -count=1` (executed; contains unrelated baseline failures outside this feature scope)
- [x] `cd frontend && pnpm test:run src/components/account/__tests__/bulkEditPayload.spec.ts`
- [x] `cd frontend && pnpm build`
</verification>

<success_criteria>

- Backend and frontend tests cover newly introduced behavior
- Manual UAT checklist is complete and actionable
- Feature is release-ready with clear validation evidence

</success_criteria>

<output>
After completion, create `.planning/phases/03-quality-gate-rollout/03-01-SUMMARY.md`
</output>
