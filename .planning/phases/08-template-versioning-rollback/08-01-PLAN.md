# Plan 08-01: 模板版本历史与回滚

## 目标

落地 BULK-13：模板每次更新自动生成版本记录，支持历史列表查看与一键回滚。

## 范围

- 后端：在模板 settings 存储中引入 `versions` 历史结构
- API：补充版本列表与回滚接口
- 前端：模板区域增加“版本历史”面板和回滚动作

## 设计草案

1. **版本模型**
   - 每个模板持有 `versions[]`（倒序）
   - 每次 upsert：先将当前快照写入 versions，再更新 current
   - 版本项包含：`version_id`、`state`、`share_scope`、`group_ids`、`updated_by`、`updated_at`

2. **回滚语义**
   - 回滚仅变更模板配置（state/share/group scope），不改变模板 ID
   - 回滚操作同样记录一条新版本，形成可追溯链

3. **接口**
   - `GET /admin/settings/bulk-edit-templates/:template_id/versions`
   - `POST /admin/settings/bulk-edit-templates/:template_id/rollback`

## 任务拆解

- [ ] 扩展服务端模板存储结构（带版本历史）
- [ ] 实现版本列表与回滚 service 方法
- [ ] 实现 handler + routes
- [ ] 前端模板版本面板与回滚确认
- [ ] 单元测试（service/handler/frontend mapper）

## 验收标准

1. 模板每次更新后，版本列表可见且按时间倒序。
2. 支持回滚到指定版本，回滚后模板配置与预期一致。
3. 回滚后仍保留完整历史链路（可继续回滚）。
4. 新增测试覆盖版本链路关键分支。
