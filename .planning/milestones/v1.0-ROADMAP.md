# Roadmap: OpenAI Bulk Edit Parity

## Overview

本里程碑聚焦“OpenAI 账号批量编辑能力补齐”。先补齐后端约束和安全边界，再扩展前端批量编辑弹窗字段，最后通过测试和回归把质量门禁补齐，确保管理员可稳定替代逐个编辑流程。

## Phases

**Phase Numbering:**
- Integer phases (1, 2, 3): Planned milestone work
- Decimal phases (2.1, 2.2): Urgent insertions (marked with INSERTED)

- [x] **Phase 1: Bulk Contract & Guardrails** - 后端补齐批量字段管道与 OpenAI 同类型校验
- [x] **Phase 2: OpenAI Bulk Edit UI** - 批量编辑弹窗补齐 OpenAI 高级开关
- [x] **Phase 3: Quality Gate & Rollout** - 测试补齐与回归验收

## Phase Details

### Phase 1: Bulk Contract & Guardrails
**Goal:** 在后端批量更新链路中补齐 `auto_pause_on_expired`，并为 OpenAI 专属 `extra` 字段增加同平台同类型保护。
**Depends on:** Nothing (first phase)
**Requirements**: [BULK-04, BULK-05, BULK-06]
**Success Criteria** (what must be TRUE):
  1. 当批量请求包含 OpenAI 专属字段且账号混选类型时，接口返回明确错误并拒绝写入。
  2. `auto_pause_on_expired` 能通过批量接口成功写入并在列表/单编辑页体现。
  3. 现有批量返回结构（含 `success_ids`/`failed_ids`）保持兼容。
**Plans**: 1 plan

Plans:
- [x] 01-01: 后端字段管道 + 同类型校验 + 单测

### Phase 2: OpenAI Bulk Edit UI
**Goal:** 在批量编辑弹窗中新增 OpenAI 自动透传、WS mode、Codex CLI only 和自动暂停字段，并按“勾选才生效”提交。
**Depends on:** Phase 1
**Requirements**: [BULK-01, BULK-02, BULK-03, BULK-07]
**Success Criteria** (what must be TRUE):
  1. 管理员可在一次提交中修改所选同类型 OpenAI 账号的自动透传与 WS mode。
  2. OAuth 账号可批量设置 `codex_cli_only`；API Key 账号不展示该项。
  3. 未勾选字段不进入请求体，避免误覆盖。
**Plans**: 1 plan

Plans:
- [x] 02-01: 批量弹窗字段扩展 + payload 构建 + i18n 文案

### Phase 3: Quality Gate & Rollout
**Goal:** 完成前后端测试覆盖、最小回归脚本和交付说明，保障上线质量。
**Depends on:** Phase 2
**Requirements**: [BULK-08]
**Success Criteria** (what must be TRUE):
  1. 后端测试覆盖新增校验与字段写入分支。
  2. 前端测试覆盖批量 payload 构建及字段开关语义。
  3. 提供可复用的手工验收清单（同类型成功、混选失败、关闭回滚）。
**Plans**: 1 plan

Plans:
- [x] 03-01: 测试补齐 + 回归验收清单

## Progress

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 1. Bulk Contract & Guardrails | 1/1 | Completed | 2026-02-28 |
| 2. OpenAI Bulk Edit UI | 1/1 | Completed | 2026-02-28 |
| 3. Quality Gate & Rollout | 1/1 | Completed | 2026-02-28 |
